window.guardarCambios=function(g){var G,K;const U={id:g.id,planilla_id:((G=g.planilla)==null?void 0:G.id)??null,users_id:g.users_id??null,users_id_2:Number(g.users_id_2)||null,etiqueta_id:((K=g.etiquetaRelacion)==null?void 0:K.id)??null,paquete_id:g.paquete_id??null,maquina_id:Number(g.maquina_id)||null,maquina_id_2:Number(g.maquina_id_2)||null,producto_id:Number(g.producto_id)||null,producto_id_2:Number(g.producto_id_2)||null,producto_id_3:Number(g.producto_id_3)||null,figura:g.figura||null,dimensiones:g.dimensiones||null,peso:g.peso||null,diametro:g.diametro||null,longitud:g.longitud||null,barras:g.barras??null,estado:g.estado??null};fetch(`/elementos/${g.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(U)}).then(O=>O.json()).then(O=>{if(O.success)window.location.reload();else{let $=O.message||"Ha ocurrido un error inesperado.";O.errors&&($=Object.values(O.errors).flat().join(" ")),Swal.fire({icon:"error",title:"Error al actualizar",text:$,confirmButtonText:"OK"})}}).catch(O=>{console.error("Error:",O),Swal.fire({icon:"error",title:"Error de conexión",text:"No se pudo actualizar el elemento. Inténtalo nuevamente.",confirmButtonText:"OK"})})};function Q(){const g=document.getElementById("modal-dibujo"),U=document.getElementById("cerrar-modal");document.getElementById("canvas-dibujo");const G="rgba(0, 0, 0, 0.8)",K=.6,O=50,$=2;function y(c){return c*Math.PI/180}function st(c){const a=(c||"").split(/\s+/).filter(Boolean),n=[];for(let e=0;e<a.length;e++){const t=a[e];if(t.endsWith("r")){const i=parseFloat(t.slice(0,-1));let s=360;e+1<a.length&&a[e+1].endsWith("d")&&(s=parseFloat(a[++e].slice(0,-1))),n.push({type:"arc",radius:i,arcAngle:s})}else t.endsWith("d")?n.push({type:"turn",angle:parseFloat(t.slice(0,-1))}):n.push({type:"line",length:parseFloat(t)})}return n}function ot(c){let a=[],n=0,e=0,t=0;a.push({x:n,y:e});for(let i=0;i<c.length;i++){const s=c[i];if(s.type==="line")n+=s.length*Math.cos(y(t)),e+=s.length*Math.sin(y(t)),a.push({x:n,y:e});else if(s.type==="turn")t+=s.angle;else if(s.type==="arc"){const o=n+s.radius*Math.cos(y(t+90)),l=e+s.radius*Math.sin(y(t+90)),p=Math.atan2(e-l,n-o),m=p+y(s.arcAngle);n=o+s.radius*Math.cos(m),e=l+s.radius*Math.sin(m),t+=s.arcAngle,a.push({x:n,y:e})}}return a}function at(c,a){return!a||a===1?c.map(n=>({...n})):c.map(n=>n.type==="line"?{...n,length:(n.length||0)*a}:n.type==="arc"?{...n,radius:(n.radius||0)*a}:{...n})}function rt(c,a){const e=[];let t=0;function i(){t>1e-9&&(e.push({type:"line",length:t}),t=0)}for(let s=0;s<c.length;s++){const o=c[s];if(o.type==="line"){t+=o.length;continue}if(o.type==="turn"){if(Math.abs(o.angle)<1e-9)continue;i(),e.push(o);continue}if(o.type==="arc"){i(),e.push(o);continue}i(),e.push(o)}return i(),e}function ct(c,a){const n=a,e=c.map(d=>Object.assign({},d));let t=0,i=0,s=0;const o=[];let l=null,p=-1,m=-1;const x=1e-7;function A(d){return Math.abs(Math.sin(y(d)))<1e-12}function E(d,h,r,b){return Math.min(h,b)-Math.max(d,r)>x}for(let d=0;d<e.length;d++){let r=function(){const P={x:Math.cos(y(s)),y:Math.sin(y(s))},N=t+e[d].length*P.x,D=i+e[d].length*P.y,L=A(s);for(let k=0;k<o.length;k++){const M=o[k];if(L&&M.horiz&&Math.abs(i-M.y)<x){if(E(Math.min(t,N),Math.max(t,N),Math.min(M.x1,M.x2),Math.max(M.x1,M.x2))&&l&&p>=0&&m>=0)return e[m].length+=n,t+=l.x*n,i+=l.y*n,o[p].x2+=l.x*n,o[p].y2+=l.y*n,!0}else if(!L&&!M.horiz&&Math.abs(t-M.x)<x&&E(Math.min(i,D),Math.max(i,D),Math.min(M.y1,M.y2),Math.max(M.y1,M.y2))&&l&&p>=0&&m>=0)return e[m].length+=n,t+=l.x*n,i+=l.y*n,o[p].x2+=l.x*n,o[p].y2+=l.y*n,!0}return!1};var S=r;const h=e[d];if(h.type==="turn"){s+=h.angle;continue}if(h.type==="arc"){const P=t+h.radius*Math.cos(y(s+90)),N=i+h.radius*Math.sin(y(s+90)),L=Math.atan2(i-N,t-P)+y(h.arcAngle);t=P+h.radius*Math.cos(L),i=N+h.radius*Math.sin(L),s+=h.arcAngle,l=null;continue}for(;r(););const b={x:Math.cos(y(s)),y:Math.sin(y(s))},C=t+e[d].length*b.x,f=i+e[d].length*b.y,Y=A(s);o.push({x1:t,y1:i,x2:C,y2:f,horiz:Y,y:i,x:t}),l=b,p=o.length-1,m=d,t=C,i=f}return e}function V(c,a,n,e){const t=y(e),i=Math.cos(t),s=Math.sin(t),o=c.x-a,l=c.y-n;return{x:a+o*i-l*s,y:n+o*s+l*i}}function lt(c,a,n){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");return e.setAttribute("viewBox","0 0 "+c+" "+a),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.style.width="100%",e.style.height="100%",e.style.display="block",e.style.background=n,e.style.shapeRendering="geometricPrecision",e.style.textRendering="optimizeLegibility",e.style.boxSizing="border-box",e}function X(c,a,n,e,t,i,s){const o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttribute("x",a),o.setAttribute("y",n),o.setAttribute("fill",t||"black"),o.setAttribute("font-size",i||16),o.setAttribute("text-anchor",s||"middle"),o.setAttribute("alignment-baseline","middle"),o.style.pointerEvents="none",o.textContent=e,c.appendChild(o)}function dt(c,a,n,e){const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d",a),t.setAttribute("stroke",n),t.setAttribute("fill","none"),t.setAttribute("stroke-width",e||2),t.setAttribute("vector-effect","non-scaling-stroke"),c.appendChild(t),t}function ut(c,a){const n=Math.hypot(c,a)||1;let e=c/n,t=a/n;return(t<-1e-9||Math.abs(t)<=1e-9&&e<0)&&(e=-e,t=-t),{ux:e,uy:t}}function ht(c,a,n=.01){const e=ut(c,a),t=Math.round(e.ux/n)*n,i=Math.round(e.uy/n)*n;return t+"|"+i}function gt(c){const a=new Set,n=[];for(let e=0;e<c.length;e++){const t=c[e],i=t.p2.x-t.p1.x,s=t.p2.y-t.p1.y,o=ht(i,s),l=Math.round(t.length).toString(),p=o+"|"+l;a.has(p)||(a.add(p),n.push({p1:t.p1,p2:t.p2,label:l,length:t.length}))}return n}function yt(c,a,n,e,t){const i=n.x-a.x,s=n.y-a.y,o=Math.hypot(i,s)||1,l=s/o,p=-i/o,m=(a.x+n.x)/2,x=(a.y+n.y)/2,A=t*.8,E=m+l*A,S=x+p*A,d=document.createElementNS("http://www.w3.org/2000/svg","text");d.setAttribute("x",E),d.setAttribute("y",S),d.setAttribute("fill","black"),d.setAttribute("font-size",t),d.setAttribute("font-weight","bold"),d.setAttribute("text-anchor","middle"),d.setAttribute("alignment-baseline","middle"),d.style.pointerEvents="none",d.textContent=e,c.appendChild(d)}function pt(c,a,n,e,t,i,s,o,l){let p="",m=0,x=0,A=0,E=!1;function S(h,r){const b=V({x:h,y:r},a,n,e);return{x:o+(b.x-i)*t,y:l+(b.y-s)*t}}function d(){if(!E){const h=S(m,x);p+="M "+h.x+" "+h.y,E=!0}}for(let h=0;h<c.length;h++){const r=c[h];if(r.type==="turn"){A+=r.angle;continue}if(r.type==="line"){const b=m+r.length*Math.cos(y(A)),C=x+r.length*Math.sin(y(A));d();const f=S(b,C);p+=" L "+f.x+" "+f.y,m=b,x=C;continue}if(r.type==="arc"){const b=m+r.radius*Math.cos(y(A+90)),C=x+r.radius*Math.sin(y(A+90)),f=Math.atan2(x-C,m-b),Y=f+y(r.arcAngle),P=b+r.radius*Math.cos(Y),N=C+r.radius*Math.sin(Y),D=Math.abs(r.arcAngle)%360;if(d(),D<1e-6||Math.abs(r.arcAngle)>=359.9){const L=f+Math.sign(r.arcAngle)*Math.PI,k=b+r.radius*Math.cos(L),M=C+r.radius*Math.sin(L),q=S(k,M),B=S(m,x),z=r.radius*t,J=r.arcAngle>=0?1:0;p+=" A "+z+" "+z+" 0 1 "+J+" "+q.x+" "+q.y,p+=" A "+z+" "+z+" 0 1 "+J+" "+B.x+" "+B.y}else{const L=S(P,N),k=r.radius*t,M=D>180?1:0,q=r.arcAngle>=0?1:0;p+=" A "+k+" "+k+" 0 "+M+" "+q+" "+L.x+" "+L.y}m=P,x=N,A+=r.arcAngle}}return p}function tt(c){const a=ot(c);if(a.length===0)return null;let n=a[0].x,e=a[0].x,t=a[0].y,i=a[0].y;for(const f of a)n=Math.min(n,f.x),e=Math.max(e,f.x),t=Math.min(t,f.y),i=Math.max(i,f.y);const s=e-n,o=i-t,l=(n+e)/2,p=(t+i)/2,m=0,x=0;let A=0;s<o&&(A=90);const E=a.map(f=>V(f,m,x,A));let S=E[0].x,d=E[0].x,h=E[0].y,r=E[0].y;for(const f of E)S=Math.min(S,f.x),d=Math.max(d,f.x),h=Math.min(h,f.y),r=Math.max(r,f.y);const b=(S+d)/2,C=(h+r)/2;return{w:s,h:o,minX:n,maxX:e,minY:t,maxY:i,midX:l,midY:p,midXRot:b,midYRot:C,cxModel:m,cyModel:x,rotDeg:A,wRot:d-S,hRot:r-h,ptsRot:E}}function et(c,a,n,e,t){let i=document.getElementById(c);if(!i)return;let s,o;if(i.tagName.toLowerCase()==="canvas"){s=i.width||parseInt(i.style.width)||240,o=i.height||parseInt(i.style.height)||120;const _=window.getComputedStyle(i),w=document.createElement("div");w.id=c,w.style.width="100%",w.style.height=_.height||o+"px",w.style.display="block",w.style.margin="0",w.style.padding="0",w.style.boxSizing="border-box",w.style.overflow="hidden",w.style.border=_.border||"1px solid #e5e7eb",w.style.borderRadius=_.borderRadius||"4px",w.style.background="white",w.className=i.className,i.parentNode.replaceChild(w,i),i=w;const W=w.getBoundingClientRect();s=W.width||s,o=W.height||o}else{const _=i.getBoundingClientRect();s=_.width>0?_.width:parseInt(i.style.width)||600,o=_.height>0?_.height:parseInt(i.style.height)||400}const l=lt(s,o,"white"),p=st(a);if(p.length===0){X(l,s/2,o/2,"Sin dimensiones válidas","#FF0000",16,"middle"),i.innerHTML="",i.appendChild(l);return}const m=rt(p);let x=0;for(const _ of m)_.type==="line"&&(x=Math.max(x,Math.abs(_.length||0))),_.type==="arc"&&(x=Math.max(x,Math.abs(_.radius||0)));const E=x<=O?$:1,S=at(m,E);if(!tt(S)){X(l,s/2,o/2,"Error al medir figura","#FF0000",16,"middle"),i.innerHTML="",i.appendChild(l);return}const h=ct(S,K),r=tt(h),b=r.wRot||1,C=r.hRot||1,f=.15,Y=s*(1-f),P=o*(1-f);let N=Math.min(Y/b,P/C);(s<300||o<150)&&(N*=.95);const D=s/2,L=o/2,k=pt(h,r.cxModel,r.cyModel,r.rotDeg,N,r.midXRot,r.midYRot,D,L);if(k&&k.length>0){const _=s<300?1.5:2;if(dt(l,k,G,_),s>150&&o>80){let W=function(v,u){const R=V({x:v,y:u},r.cxModel,r.cyModel,r.rotDeg);return{x:D+(R.x-r.midXRot)*N,y:L+(R.y-r.midYRot)*N}};var J=W;const w=s<300?8:10,nt=[],it=[];let I=0,F=0,j=0;for(let v=0;v<h.length;v++){const u=h[v];if(u.type==="line"){const R={x:I,y:F};I+=u.length*Math.cos(y(j)),F+=u.length*Math.sin(y(j));const T={x:I,y:F},Z=W(R.x,R.y),H=W(T.x,T.y);nt.push({p1:Z,p2:H,length:u.length})}else if(u.type==="turn")j+=u.angle;else if(u.type==="arc"){const R=I+u.radius*Math.cos(y(j+90)),T=F+u.radius*Math.sin(y(j+90)),H=Math.atan2(F-T,I-R)+y(u.arcAngle);I=R+u.radius*Math.cos(H),F=T+u.radius*Math.sin(H),j+=u.arcAngle}}I=0,F=0,j=0;for(let v=0;v<m.length;v++){const u=m[v];if(u.type==="line")it.push({length:u.length}),I+=u.length*Math.cos(y(j)),F+=u.length*Math.sin(y(j));else if(u.type==="turn")j+=u.angle;else if(u.type==="arc"){const R=I+u.radius*Math.cos(y(j+90)),T=F+u.radius*Math.sin(y(j+90)),H=Math.atan2(F-T,I-R)+y(u.arcAngle);I=R+u.radius*Math.cos(H),F=T+u.radius*Math.sin(H),j+=u.arcAngle}}const mt=nt.map((v,u)=>{var R;return{p1:v.p1,p2:v.p2,length:((R=it[u])==null?void 0:R.length)||v.length}});gt(mt).forEach(v=>{yt(l,v.p1,v.p2,v.label,w)})}}else X(l,s/2,o/2,"Path vacío","#FF0000",16,"middle");const M=s<300?10:12,q=15;let B=25;const z=M+8;n&&(X(l,q,B,`Peso: ${n} kg`,"#333333",M,"start"),B+=z),e&&(X(l,q,B,`Ø: ${e} mm`,"#333333",M,"start"),B+=z),t&&X(l,q,B,`Barras: ${t}`,"#333333",M,"start"),i.innerHTML="",i.appendChild(l)}window.dibujarFiguraElemento=et,document.querySelectorAll(".abrir-modal-dibujo").forEach(c=>{c.addEventListener("click",function(a){a.preventDefault();const n=this.getAttribute("data-dimensiones"),e=this.getAttribute("data-peso")||"N/A";g.classList.remove("hidden");let t=document.getElementById("svg-dibujo-container");if(!t){const i=document.getElementById("canvas-dibujo");i&&i.parentNode?(t=document.createElement("div"),t.id="svg-dibujo-container",t.style.width="100%",t.style.height="100%",i.style.display="none",i.parentNode.insertBefore(t,i)):(t=document.createElement("div"),t.id="svg-dibujo-container",t.style.width="100%",t.style.minHeight="200px",g.querySelector(".modal-content")?g.querySelector(".modal-content").appendChild(t):g.appendChild(t))}et("svg-dibujo-container",n,e)})}),U&&U.addEventListener("click",function(){g.classList.add("hidden")}),g&&g.addEventListener("click",function(c){c.target===g&&g.classList.add("hidden")})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Q):Q();document.addEventListener("livewire:navigated",Q);

const Xt="rgba(0, 0, 0, 0.8)",Bt="rgba(0, 0, 0, 1)",Rt="rgba(0, 0, 0, 1)";function Ht(y,s){return!s||s===1?y.map(a=>({...a})):y.map(a=>a.type==="line"?{...a,length:(a.length||0)*s}:a.type==="arc"?{...a,radius:(a.radius||0)*s}:{...a})}const Vt=.75,Dt=14,Yt=60,Ot=[0,10,-10,20,-20,30,-30];function P(y){return y*Math.PI/180}function Ut(y){const s=y.closest(".proceso");return s&&getComputedStyle(s).getPropertyValue("--bg-estado").trim()||"#e5e7eb"}function Wt(y,s,a){const o=document.createElementNS("http://www.w3.org/2000/svg","svg");return o.setAttribute("viewBox","0 0 "+y+" "+s),o.setAttribute("preserveAspectRatio","xMidYMid meet"),o.style.width="100%",o.style.height="100%",o.style.display="block",o.style.background=a||"#ffffff",o.style.shapeRendering="geometricPrecision",o.style.textRendering="optimizeLegibility",o.style.boxSizing="border-box",o}function Jt(y,s,a,o){const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",s),n.setAttribute("stroke",a),n.setAttribute("fill","none"),n.setAttribute("stroke-width",o),n.setAttribute("vector-effect","non-scaling-stroke"),y.appendChild(n),n}function Ft(y){let s="",a=Number(y)||0;for(;a>=0;){const o=a%26;s=String.fromCharCode(65+o)+s,a=Math.floor(a/26)-1}return s}const Kt=0,Qt=-25;function Zt(y,s,a,o){if(!s||!s.length)return;const n=2,m=12,c=m+n,w=s.map(A=>(A.letter?A.letter+" ":"")+(A.text||"")),t=m*w.length+n*(w.length-1),i=Kt;let g=o-Qt-t+m/2;window.__legendBoxesGroup=window.__legendBoxesGroup||[];for(let A=0;A<w.length;A++){const d=w[A],p=document.createElementNS("http://www.w3.org/2000/svg","text");p.setAttribute("x",i),p.setAttribute("y",g),p.setAttribute("fill",Rt),p.setAttribute("font-size",m),p.setAttribute("text-anchor","start"),p.setAttribute("alignment-baseline","middle"),p.style.pointerEvents="none",p.textContent=d,y.appendChild(p);const l=Ct(d,m).w;window.__legendBoxesGroup.push({left:i,right:i+l,top:g-m/2,bottom:g+m/2}),g+=c}}function te(y){const s=(y||"").split(/\s+/).filter(Boolean),a=[];for(let o=0;o<s.length;o++){const n=s[o];if(n.endsWith("r")){const m=parseFloat(n.slice(0,-1));let c=360;o+1<s.length&&s[o+1].endsWith("d")&&(c=parseFloat(s[++o].slice(0,-1))),a.push({type:"arc",radius:m,arcAngle:c})}else n.endsWith("d")?a.push({type:"turn",angle:parseFloat(n.slice(0,-1))}):a.push({type:"line",length:parseFloat(n)})}return a}function ee(y){let s=[],a=0,o=0,n=0;s.push({x:a,y:o});for(let m=0;m<y.length;m++){const c=y[m];if(c.type==="line")a+=c.length*Math.cos(P(n)),o+=c.length*Math.sin(P(n)),s.push({x:a,y:o});else if(c.type==="turn")n+=c.angle;else if(c.type==="arc"){const w=a+c.radius*Math.cos(P(n+90)),t=o+c.radius*Math.sin(P(n+90)),i=Math.atan2(o-t,a-w),g=i+P(c.arcAngle);a=w+c.radius*Math.cos(g),o=t+c.radius*Math.sin(g),n+=c.arcAngle,s.push({x:a,y:o})}}return s}function Gt(y){let s=[],a=0,o=0,n=0;for(let m=0;m<y.length;m++){const c=y[m];if(c.type==="line"){const w={x:a,y:o},t={x:a+c.length*Math.cos(P(n)),y:o+c.length*Math.sin(P(n))};s.push({start:w,end:t,length:c.length}),a=t.x,o=t.y}else if(c.type==="turn")n+=c.angle;else if(c.type==="arc"){const w=a+c.radius*Math.cos(P(n+90)),t=o+c.radius*Math.sin(P(n+90)),i=Math.atan2(o-t,a-w),g=i+P(c.arcAngle);a=w+c.radius*Math.cos(g),o=t+c.radius*Math.sin(g),n+=c.arcAngle}}return s}function Ct(y,s){const a=s||12;return{w:(y?y.length:0)*a*.55,h:a}}function Z(y,s,a){const o=a||0;return!(y.right+o<s.left||y.left-o>s.right||y.bottom+o<s.top||y.top-o>s.bottom)}function It(y,s,a,o){const n=s/2;return Math.max(a+n,Math.min(o-n,y))}function oe(y,s){const o=[];let n=0;function m(){n>1e-9&&(o.push({type:"line",length:n}),n=0)}for(let c=0;c<y.length;c++){const w=y[c];if(w.type==="line"){n+=w.length;continue}if(w.type==="turn"){if(Math.abs(w.angle)<1e-9)continue;m(),o.push(w);continue}if(w.type==="arc"){m(),o.push(w);continue}m(),o.push(w)}return m(),o}function jt(y,s){const a=s&&s.decimals||0,o=s&&s.step||null;let n=Number(y||0);return o&&o>0&&(n=Math.round(n/o)*o),n.toFixed(a).replace(/\.0+$/,"")}function ne(y,s){const a=Math.hypot(y,s)||1;let o=y/a,n=s/a;return(n<-1e-9||Math.abs(n)<=1e-9&&o<0)&&(o=-o,n=-n),{ux:o,uy:n}}function zt(y,s,a){const o=a||.01,n=ne(y,s),m=Math.round(n.ux/o)*o,c=Math.round(n.uy/o)*o;return m+"|"+c}function ae(y,s,a){const o=a&&a.dirPrecision||.01,n=a&&a.labelFormat||{decimals:0,step:null},m=y.reduce((p,l)=>p+Math.hypot(l.end.x-l.start.x,l.end.y-l.start.y),0),c=s.reduce((p,l)=>p+(l.length||Math.hypot(l.end.x-l.start.x,l.end.y-l.start.y)),0),w=c>0?m/c:1,t=new Map;for(let p=0;p<s.length;p++){const l=s[p],f=l.end.x-l.start.x,u=l.end.y-l.start.y,r=zt(f,u,o),e=t.get(r)||[];e.push({length:l.length||Math.hypot(f,u),index:p}),t.set(r,e)}const i=s.map(p=>p.length||Math.hypot(p.end.x-p.start.x,p.end.y-p.start.y)),g=new Set,A=new Set,d=[];for(let p=0;p<y.length;p++){const l=y[p],f=l.end.x-l.start.x,u=l.end.y-l.start.y,r=zt(f,u,o),e=t.get(r)||[],b=Math.hypot(f,u);let h=b;if(e.length){const q=b/w;let x=null,S=1/0;for(const D of e){const O=Math.abs(D.length-q),v=A.has(D.index)?.1:0;O+v<S&&(x=D,S=O+v)}x&&(h=x.length,A.add(x.index))}else p<i.length&&(h=i[p]);const M=jt(h,n),E=r+"|"+M;g.has(E)||(g.add(E),d.push({start:l.start,end:l.end,_dirKey:r,_label:M,_lenChosen:h}))}return d}function se(y,s){const a=s,o=y.map(u=>Object.assign({},u));let n=0,m=0,c=0;const w=[];let t=null,i=-1,g=-1;const A=1e-7;function d(u){return u*Math.PI/180}function p(u){return Math.abs(Math.sin(d(u)))<1e-12}function l(u,r,e,b){return Math.min(r,b)-Math.max(u,e)>A}for(let u=0;u<o.length;u++){let e=function(){const q={x:Math.cos(d(c)),y:Math.sin(d(c))},x=n+o[u].length*q.x,S=m+o[u].length*q.y,D=p(c);for(let O=0;O<w.length;O++){const v=w[O];if(D&&v.horiz&&Math.abs(m-v.y)<A){if(l(Math.min(n,x),Math.max(n,x),Math.min(v.x1,v.x2),Math.max(v.x1,v.x2))&&t&&i>=0&&g>=0)return o[g].length+=a,n+=t.x*a,m+=t.y*a,w[i].x2+=t.x*a,w[i].y2+=t.y*a,!0}else if(!D&&!v.horiz&&Math.abs(n-v.x)<A&&l(Math.min(m,S),Math.max(m,S),Math.min(v.y1,v.y2),Math.max(v.y1,v.y2))&&t&&i>=0&&g>=0)return o[g].length+=a,n+=t.x*a,m+=t.y*a,w[i].x2+=t.x*a,w[i].y2+=t.y*a,!0}return!1};var f=e;const r=o[u];if(r.type==="turn"){c+=r.angle;continue}if(r.type==="arc"){const q=n+r.radius*Math.cos(d(c+90)),x=m+r.radius*Math.sin(d(c+90)),S=Math.atan2(m-x,n-q),D=S+d(r.arcAngle);n=q+r.radius*Math.cos(D),m=x+r.radius*Math.sin(D),c+=r.arcAngle,t=null;continue}for(;e(););const b={x:Math.cos(d(c)),y:Math.sin(d(c))},h=n+o[u].length*b.x,M=m+o[u].length*b.y,E=p(c);w.push({x1:n,y1:m,x2:h,y2:M,horiz:E,y:m,x:n}),t=b,i=w.length-1,g=u,n=h,m=M}return o}function At(y,s,a,o){const n=P(o),m=Math.cos(n),c=Math.sin(n),w=y.x-s,t=y.y-a;return{x:s+w*m-t*c,y:a+w*c+t*m}}function ie(y,s,a,o,n,m,c,w,t){let i="",g=0,A=0,d=0,p=!1;function l(u,r){const e=At({x:u,y:r},s,a,o);return{x:w+(e.x-m)*n,y:t+(e.y-c)*n}}function f(){if(!p){const u=l(g,A);i+="M "+u.x+" "+u.y,p=!0}}for(let u=0;u<y.length;u++){const r=y[u];if(r.type==="turn"){d+=r.angle;continue}if(r.type==="line"){const e=g+r.length*Math.cos(P(d)),b=A+r.length*Math.sin(P(d));f();const h=l(e,b);i+=" L "+h.x+" "+h.y,g=e,A=b;continue}if(r.type==="arc"){const e=g+r.radius*Math.cos(P(d+90)),b=A+r.radius*Math.sin(P(d+90)),h=Math.atan2(A-b,g-e),M=h+P(r.arcAngle),E=e+r.radius*Math.cos(M),q=b+r.radius*Math.sin(M),x=Math.abs(r.arcAngle)%360;if(f(),x<1e-6||Math.abs(r.arcAngle)>=359.9){const tt=h+Math.sign(r.arcAngle)*Math.PI,H=e+r.radius*Math.cos(tt),B=b+r.radius*Math.sin(tt),N=l(H,B),R=l(g,A),L=r.radius*n,et=r.arcAngle>=0?1:0;i+=" A "+L+" "+L+" 0 1 "+et+" "+N.x+" "+N.y,i+=" A "+L+" "+L+" 0 1 "+et+" "+R.x+" "+R.y,d+=r.arcAngle;continue}const S=l(E,q),D=r.radius*n,O=x>180?1:0,v=r.arcAngle>=0?1:0;i+=" A "+D+" "+D+" 0 "+O+" "+v+" "+S.x+" "+S.y,g=E,A=q,d+=r.arcAngle}}return i||"M 0 0"}function re(y){const s=ee(y);let a=Math.min(...s.map(f=>f.x)),o=Math.max(...s.map(f=>f.x)),n=Math.min(...s.map(f=>f.y)),m=Math.max(...s.map(f=>f.y));const c=(a+o)/2,w=(n+m)/2,i=m-n>o-a?-90:0,g=s.map(f=>At(f,c,w,i));a=Math.min(...g.map(f=>f.x)),o=Math.max(...g.map(f=>f.x)),n=Math.min(...g.map(f=>f.y)),m=Math.max(...g.map(f=>f.y));const A=Math.max(1,o-a),d=Math.max(1,m-n),p=(a+o)/2,l=(n+m)/2;return{rotDeg:i,w:A,h:d,cxModel:c,cyModel:w,midX:p,midY:l,ptsRot:g}}function ce(y){const s=[];let a=0,o=0,n=0;function m(c){const w=P(c);return{x:Math.cos(w),y:Math.sin(w)}}for(let c=0;c<y.length;c++){const w=y[c];if(w.type==="line")a+=w.length*Math.cos(P(n)),o+=w.length*Math.sin(P(n));else if(w.type==="turn"){const t=m(n),i=w.angle;n+=i;const g=m(n);s.push({x:a,y:o,angleDeg:i,prevDir:t,nextDir:g})}else if(w.type==="arc"){const t=a+w.radius*Math.cos(P(n+90)),i=o+w.radius*Math.sin(P(n+90)),g=Math.atan2(o-i,a-t),A=g+P(w.arcAngle);a=t+w.radius*Math.cos(A),o=i+w.radius*Math.sin(A),n+=w.arcAngle}}return s}function le(y,s,a){const o=Array.from({length:s},()=>({sumH:0,maxW:0,items:[]})),n=[...y.keys()].sort((m,c)=>y[c].h-y[m].h);for(const m of n){let c=0,w=1/0;for(let i=0;i<s;i++){const g=o[i],A=g.sumH+(g.items.length>0?a:0)+y[m].h;A<w&&(w=A,c=i)}const t=o[c];t.sumH=t.items.length>0?t.sumH+a+y[m].h:t.sumH+y[m].h,t.maxW=Math.max(t.maxW,y[m].w),t.items.push(m)}return o}function de(y,s,a,o={}){const n=o.padding??12,m=o.gapCol??12,c=o.gapRow??10,w=Math.max(1,Math.min(y.length,o.kMax??4)),t=Math.max(10,s-2*n),i=Math.max(10,a-2*n),g=A(y);function A(e){const b=e.map(L=>L.w/Math.max(L.h,1)),h=e.map(L=>L.h),M=e.map(L=>L.w),E=e.map(L=>L.w*L.h),q=L=>L.reduce((et,ht)=>et+ht,0)/L.length,x=(L,et)=>L.reduce((ht,pt)=>ht+Math.pow(pt-et,2),0)/L.length,S=(L,et)=>Math.sqrt(x(L,et)),D=q(b),O=q(h),v=q(M),tt=E.reduce((L,et)=>L+et,0),H=S(h,O),B=S(M,v),N=O>0?H/O:0,R=v>0?B/v:0;return{avgAspectRatio:D,avgHeight:O,avgWidth:v,totalArea:tt,heightCV:N,widthCV:R,isLinear:D>6||O<v*.12,isUniformHeight:N<.15,isUniformWidth:R<.15,isHighlyVariable:N>.5||R>.5,count:e.length}}let d={S:0,k:1,cols:null,score:0};for(let e=1;e<=w;e++){const b=le(y,e,c),h=b.reduce((pt,$)=>pt+$.maxW,0)+m*(e-1),M=Math.max(...b.map(pt=>pt.sumH));if(h<=0||M<=0)continue;const E=t/h,q=i/M,x=Math.min(E,q),S=Math.max(.01,x*.92),D=g.totalArea*S*S,O=t*i,v=D/O,tt=b.map(pt=>pt.sumH*S),H=tt.reduce((pt,$)=>pt+$,0)/e,B=Math.max(...tt)-Math.min(...tt),N=H>0?1-B/H:1,R=e===1?1.1:e===2?.9:.7,L=e>g.count*.5?.7:1,et=N>.85?1.05:1,ht=S*(1+v*.25)*(1+N*.1)*R*L*et;ht>d.score&&(d={S,k:e,cols:b,score:ht,efficiency:v,colBalance:N})}const p=d.cols.map(e=>e.maxW*d.S),l=p.reduce((e,b)=>e+b,0);let f=[];if(d.k===1)f[0]=s/2;else{const e=(d.k-1)*m,b=l+e;if(b<t){const h=t-b,M=m+h/(d.k-1);let E=n;for(let q=0;q<d.k;q++)f[q]=E+p[q]/2,E+=p[q]+M}else{let h=n+Math.max(0,(t-b)/2);for(let M=0;M<d.k;M++)f[M]=h+p[M]/2,h+=p[M]+m}}const u=[],r=()=>!window.__legendBoxesGroup||window.__legendBoxesGroup.length===0?0:Math.max(...window.__legendBoxesGroup.map(e=>e.right));for(let e=0;e<d.k;e++){const b=d.cols[e];u[e]=[];const h=b.items.map(B=>y[B].h*d.S),M=h.reduce((B,N)=>B+N,0);if(b.items.length===0)continue;const E=f[e],q=d.cols[e].maxW*d.S,x=E-q/2,S=E+q/2,D=r(),v=Math.max(0,Math.min(S,D)-x)/q,tt=v>.05;let H=i;if(tt&&window.__legendBoxesGroup&&window.__legendBoxesGroup.length>0){const N=Math.min(...window.__legendBoxesGroup.map(R=>R.top))-15;H=Math.max(10,N-n),console.log(`üìè Columna ${e}: X=${x.toFixed(0)}-${S.toFixed(0)}, legendWidth=${D.toFixed(0)}, solape=${(v*100).toFixed(0)}%, altura reducida a ${H.toFixed(0)}px`)}else console.log(`üìè Columna ${e}: X=${x.toFixed(0)}-${S.toFixed(0)}, legendWidth=${D.toFixed(0)}, solape=${(v*100).toFixed(0)}%, altura completa ${H.toFixed(0)}px`);if(b.items.length===1){const B=h[0],N=n+H/2,R=Math.max(n+B/2,Math.min(N,a-n-B/2));u[e].push(R);continue}if(M>H){console.warn(`Columna ${e}: elementos no caben (${M}px > ${H}px)`);const R=M/b.items.length<4?20:5;let L=n;for(let et=0;et<b.items.length;et++){const ht=Math.max(h[et],2),pt=L+ht/2;u[e].push(pt),L+=ht+R}}else{const B=H-M,N=b.items.length-1;let R=B/N;M/b.items.length<4?R=Math.max(18,Math.min(R,50)):R=Math.max(5,R);const ht=M+N*R,pt=H-ht;let $=n+Math.max(0,pt/2);for(let nt=0;nt<b.items.length;nt++){const ct=Math.max(h[nt],2),C=$+ct/2,X=n+H-ct/2,T=Math.max(n+ct/2,Math.min(C,X));u[e].push(T),$+=ct+R}}}return{S:d.S,k:d.k,cols:d.cols,centersX:f,centersYByCol:u,padding:n,gapRow:c,gapCol:m}}window.renderizarGrupoSVG=function(s,a){const o=s&&s.etiqueta&&s.etiqueta.id!=null?s.etiqueta.id:s&&s.id!=null?s.id:a,n=document.getElementById("contenedor-svg-"+o);if(!n)return;const m=600,c=150,w=Ut(n),t=Wt(m,c,w);window.__placedLetterBoxes=[],window.__figBoxesGroup=[],window.__dimBoxesGroup=[],window.__angleBoxesGroup=[],window.__legendBoxesGroup=[];const i=(s.elementos||[]).map((l,f)=>{var h,M,E;const u=l.barras!=null?l.barras:0;let r="N/A";if(l.diametro!=null&&l.diametro!==""){const x=String(l.diametro).replace(",",".").match(/-?\d+(?:\.\d+)?/);if(x){const S=parseFloat(x[0]);isFinite(S)&&(r=String(Math.round(S)))}}const e=[];(h=l.coladas)!=null&&h.colada1&&e.push(l.coladas.colada1),(M=l.coladas)!=null&&M.colada2&&e.push(l.coladas.colada2),(E=l.coladas)!=null&&E.colada3&&e.push(l.coladas.colada3);const b=e.length>0?` (${e.join(", ")})`:"";return{letter:Ft(f),text:`√ò${r} x${u}${b}`}});Zt(t,i,m,c);const g=s.elementos.map(l=>{const f=te(l.dimensiones||""),u=oe(f);let r=0;for(const E of u)E.type==="line"&&(r=Math.max(r,Math.abs(E.length||0))),E.type==="arc"&&(r=Math.max(r,Math.abs(E.radius||0)));const b=r<=50?2:1,h=Ht(u,b),M=re(h);return{dimsRaw:f,dimsNoZero:u,dimsScaled:h,geomScale:b,medida:M}}),A=g.map(l=>l.medida),d=de(A,m,c,{padding:20,gapCol:50,gapRow:22,kMax:3}),p=new Map;for(let l=0;l<d.k;l++)d.cols[l].items.forEach((f,u)=>p.set(f,{c:l,j:u}));s.elementos.forEach(function(l,f){const{dimsNoZero:u,dimsScaled:r,medida:e}=g[f],b=p.get(f),h=d.centersX[b.c],M=d.centersYByCol[b.c][b.j],E=d.S,q=e.ptsRot.map($=>({x:h+($.x-e.midX)*E,y:M+($.y-e.midY)*E})),x=Math.min(...q.map($=>$.x)),S=Math.max(...q.map($=>$.x)),D=Math.min(...q.map($=>$.y)),O=Math.max(...q.map($=>$.y)),v={left:x,right:S,top:D,bottom:O};window.__figBoxesGroup.push({...v});const tt=se(r,.6),H=ie(tt,e.cxModel,e.cyModel,e.rotDeg,E,e.midX,e.midY,h,M),B=Jt(t,H,Xt,2);(function(){const nt=ce(r);function ct(_){return Math.abs(Math.abs(_)-90)>=Vt}const C=(_,I)=>At({x:_.x,y:_.y},0,0,I),X=(_,I)=>{const V=At({x:_,y:I},e.cxModel,e.cyModel,e.rotDeg);return{x:h+(V.x-e.midX)*E,y:M+(V.y-e.midY)*E}},T=_=>Math.max(10,Math.min(28,_));nt.forEach(_=>{if(!ct(_.angleDeg))return;const I=X(_.x,_.y),V=C(_.prevDir,e.rotDeg),ut=C(_.nextDir,e.rotDeg),Y=Math.atan2(V.y,V.x),F=Y+P(_.angleDeg),U=Math.min(v.right-v.left,v.bottom-v.top);let k=T(.12*U);const gt=I.x+k*Math.cos(Y),mt=I.y+k*Math.sin(Y),j=I.x+k*Math.cos(F),wt=I.y+k*Math.sin(F),W=Math.abs(_.angleDeg),at=W>180?1:0,vt=_.angleDeg>=0?1:0,st=document.createElementNS("http://www.w3.org/2000/svg","path");st.setAttribute("d",`M ${gt} ${mt} A ${k} ${k} 0 ${at} ${vt} ${j} ${wt}`),st.setAttribute("stroke","rgba(255,99,71,0.7)"),st.setAttribute("stroke-width","2"),st.setAttribute("fill","none"),st.style.pointerEvents="none",t.appendChild(st);let G=V.x+ut.x,z=V.y+ut.y;W>180&&(G=-G,z=-z);let J=Math.hypot(G,z);if(J<1e-6){const rt=_.angleDeg>=0?1:-1;G=-V.y*rt,z=V.x*rt,J=Math.hypot(G,z)||1}G/=J,z/=J;const K=(Math.round(_.angleDeg*100)/100).toString().replace(/\.0+$/,"")+"¬∞",Q=Ct(K,14);function Mt(rt,lt){return{left:rt-Q.w/2,right:rt+Q.w/2,top:lt-Q.h/2,bottom:lt+Q.h/2}}let ot=null;for(let rt=Dt;rt<=Yt&&!ot;rt+=4)for(let lt=0;lt<Ot.length&&!ot;lt++){const yt=Ot[lt],xt=C({x:G,y:z},yt),Et=I.x+xt.x*(k+rt),dt=I.y+xt.y*(k+rt),ft=Mt(Et,dt);ft.top<0||ft.bottom>c||ft.left<0||ft.right>m||window.__figBoxesGroup.some(bt=>Z(bt,ft,6))||(window.__dimBoxesGroup||[]).some(bt=>Z(bt,ft,2))||(window.__angleBoxesGroup||[]).some(bt=>Z(bt,ft,2))||(window.__placedLetterBoxes||[]).some(bt=>Z(bt,ft,2))||(window.__legendBoxesGroup||[]).some(bt=>Z(bt,ft,6))||(ot={x:Et,y:dt,box:ft})}if(!ot){const rt=I.x+G*(k+Dt),lt=I.y+z*(k+Dt),yt=Mt(rt,lt);ot={x:rt,y:lt,box:yt}}window.__angleBoxesGroup.push(ot.box);const it=document.createElementNS("http://www.w3.org/2000/svg","text");it.setAttribute("x",ot.x),it.setAttribute("y",ot.y),it.setAttribute("fill",Bt),it.setAttribute("font-size",14),it.setAttribute("text-anchor","middle"),it.setAttribute("alignment-baseline","middle"),it.style.cursor="pointer",it.textContent=K,t.appendChild(it),it.addEventListener("mouseenter",()=>{st.setAttribute("stroke","rgba(255,69,0,1)"),st.setAttribute("stroke-width","3"),st.style.filter="drop-shadow(0 0 2px rgba(255,69,0,0.7))"}),it.addEventListener("mouseleave",()=>{st.setAttribute("stroke","rgba(255,99,71,0.7)"),st.setAttribute("stroke-width","2"),st.style.filter="none"})})})();const N=B.cloneNode(!1);N.setAttribute("stroke-width","50"),N.setAttribute("stroke","transparent"),N.setAttribute("fill","none"),N.style.cursor="pointer",["click","contextmenu","mouseenter","mouseleave","keydown"].forEach($=>{N.addEventListener($,nt=>B.dispatchEvent(new nt.constructor(nt.type,nt)))}),t.insertBefore(N,B);const R=(l.codigo!=null?l.codigo:l.id)+"";B.style.cursor="pointer",B.setAttribute("title","Click: dividir ¬∑ Ctrl/Shift/‚åò+Click o bot√≥n derecho: info"),B.addEventListener("click",function($){if($.ctrlKey||$.metaKey||$.shiftKey){$.preventDefault(),window.mostrarPanelInfoElemento&&window.mostrarPanelInfoElemento(l.id);return}abrirModalDividirElemento(l.id,R)}),B.addEventListener("contextmenu",function($){$.preventDefault(),window.mostrarPanelInfoElemento&&window.mostrarPanelInfoElemento(l.id)});const L=[],et=Gt(tt),ht=Gt(u);ae(et,ht,{dirPrecision:.01,labelFormat:{decimals:0,step:null}}).forEach(function($){const nt=At($.start,e.cxModel,e.cyModel,e.rotDeg),ct=At($.end,e.cxModel,e.cyModel,e.rotDeg),C={x:h+(nt.x-e.midX)*E,y:M+(nt.y-e.midY)*E},X={x:h+(ct.x-e.midX)*E,y:M+(ct.y-e.midY)*E},T=$._label,_=X.x-C.x,I=X.y-C.y,V=Math.hypot(_,I)||1,ut=_/V,Y=I/V,F=I/V,U=-_/V,k=(C.x+X.x)/2,gt=(C.y+X.y)/2,mt=k+F*10,j=gt+U*10,wt=Ct(T,14),W=wt.w,at=wt.h;function vt(ot,it){return{left:ot-W/2,right:ot+W/2,top:it-at/2,bottom:it+at/2}}const st=V*.45;let G=mt,z=j;for(let ot=0;ot<=Math.ceil(st/6);ot++){const it=ot%2===0?1:-1,rt=Math.ceil(ot/2),lt=it*rt*6;if(Math.abs(lt)>st)continue;const yt=mt+ut*lt,xt=j+Y*lt,Et=(yt-C.x)*ut+(xt-C.y)*Y;if(Et<0+W*.3||Et>V-W*.3)continue;const dt=vt(yt,xt);if(!(Z({left:Math.min(C.x,X.x),right:Math.max(C.x,X.x),top:Math.min(C.y,X.y),bottom:Math.max(C.y,X.y)},dt,0)||(window.__angleBoxesGroup||[]).some(St=>Z(St,dt,2))||(window.__legendBoxesGroup||[]).some(St=>Z(St,dt,6))||L.some(St=>Z(St,dt,2))||dt.top<0||dt.bottom>c||dt.left<0||dt.right>m)){G=yt,z=xt,L.push(dt),window.__dimBoxesGroup.push(dt);break}}const J=document.createElementNS("http://www.w3.org/2000/svg","line");J.setAttribute("x1",C.x),J.setAttribute("y1",C.y),J.setAttribute("x2",X.x),J.setAttribute("y2",X.y),J.setAttribute("stroke","rgba(0,0,255,0.6)"),J.setAttribute("stroke-width","4"),J.setAttribute("stroke-linecap","round"),J.setAttribute("vector-effect","non-scaling-stroke"),J.style.opacity=0,J.style.pointerEvents="none",J.style.transition="opacity 120ms ease",t.appendChild(J);const K=document.createElementNS("http://www.w3.org/2000/svg","text");K.setAttribute("x",G),K.setAttribute("y",z),K.setAttribute("fill",Bt),K.setAttribute("font-size",14),K.setAttribute("text-anchor","middle"),K.setAttribute("alignment-baseline","middle"),K.setAttribute("tabindex","0"),K.style.cursor="pointer",K.textContent=T,t.appendChild(K);function Q(){J.style.opacity=1}function Mt(){J.style.opacity=0}K.addEventListener("mouseenter",Q),K.addEventListener("mouseleave",Mt),K.addEventListener("focus",Q),K.addEventListener("blur",Mt)}),function(){const nt=[];let ct=0,C=0,X=0;for(let T=0;T<r.length;T++){const _=r[T];if(_.type==="line")ct+=_.length*Math.cos(P(X)),C+=_.length*Math.sin(P(X));else if(_.type==="turn")X+=_.angle;else if(_.type==="arc"){const I=ct+_.radius*Math.cos(P(X+90)),V=C+_.radius*Math.sin(P(X+90)),ut=Math.atan2(C-V,ct-I),Y=ut+P(_.arcAngle);let F=_.radius;for(let U=0;U<u.length;U++){const k=u[U];if(k.type==="arc"&&Math.abs(k.arcAngle-_.arcAngle)<.01){F=k.radius;break}}nt.push({center:{x:I,y:V},radius:_.radius,originalRadius:F,arcAngle:_.arcAngle,startAngle:ut,endAngle:Y}),ct=I+_.radius*Math.cos(Y),C=V+_.radius*Math.sin(Y),X+=_.arcAngle}}nt.forEach(function(T){const _=At(T.center,e.cxModel,e.cyModel,e.rotDeg),I={x:h+(_.x-e.midX)*E,y:M+(_.y-e.midY)*E},V=(T.startAngle+T.endAngle)/2,ut=T.radius*E,Y="R"+jt(T.originalRadius,{decimals:0,step:null}),F=Ct(Y,14),U=[0,15,-15,30,-30,45,-45,60,-60,90,-90];let k=!1,gt,mt,j;for(let Q=0;Q<U.length&&!k;Q++){const Mt=U[Q],ot=V+P(Mt),it={x:T.center.x+T.radius*Math.cos(ot),y:T.center.y+T.radius*Math.sin(ot)},rt=At(it,e.cxModel,e.cyModel,e.rotDeg),lt={x:h+(rt.x-e.midX)*E,y:M+(rt.y-e.midY)*E},yt=lt.x-I.x,xt=lt.y-I.y,Et=Math.hypot(yt,xt)||1,dt=yt/Et,ft=xt/Et;for(let qt=8;qt<=60&&!k;qt+=6){const _t=ut*.7;if(gt=I.x+dt*_t+dt*qt,mt=I.y+ft*_t+ft*qt,j={left:gt-F.w/2,right:gt+F.w/2,top:mt-F.h/2,bottom:mt+F.h/2},!(j.top<0||j.bottom>c||j.left<0||j.right>m||window.__figBoxesGroup.some(Lt=>Z(Lt,j,2))||(window.__legendBoxesGroup||[]).some(Lt=>Z(Lt,j,2)))){k=!0;break}}}if(!k)return;L.push(j);const wt={x:gt-I.x,y:mt-I.y},W=Math.hypot(wt.x,wt.y)||1,at={x:wt.x/W,y:wt.y/W},vt=I.x+at.x*ut*.6,st=I.y+at.y*ut*.6,G=document.createElementNS("http://www.w3.org/2000/svg","line");G.setAttribute("x1",I.x),G.setAttribute("y1",I.y),G.setAttribute("x2",vt),G.setAttribute("y2",st),G.setAttribute("stroke","rgba(0,128,0,0.6)"),G.setAttribute("stroke-width","4"),G.setAttribute("stroke-linecap","round"),G.setAttribute("vector-effect","non-scaling-stroke"),G.style.opacity=0,G.style.pointerEvents="none",G.style.transition="opacity 120ms ease",t.appendChild(G);const z=document.createElementNS("http://www.w3.org/2000/svg","text");z.setAttribute("x",gt),z.setAttribute("y",mt),z.setAttribute("fill",Bt),z.setAttribute("font-size",14),z.setAttribute("text-anchor","middle"),z.setAttribute("alignment-baseline","middle"),z.setAttribute("tabindex","0"),z.style.cursor="pointer",z.textContent=Y,t.appendChild(z);function J(){G.style.opacity=1}function K(){G.style.opacity=0}z.addEventListener("mouseenter",J),z.addEventListener("mouseleave",K),z.addEventListener("focus",J),z.addEventListener("blur",K)})}(),function(){const nt=Ft(f),ct=14,C=Ct(nt,ct);function X(F,U){return{left:F,right:F+C.w,top:U-C.h/2,bottom:U+C.h/2}}let T=null;const _=(v.top+v.bottom)/2,I=Math.max(C.h/2,Math.min(_,c-C.h/2));function V(F){for(let k=0;k<=30;k+=4){const gt=k%2===0?1:-1,mt=Math.ceil(k/2),j=gt*mt*4,wt=Math.max(C.h/2,Math.min(c-C.h/2,I+j)),W=F,at=X(W,wt);if(!(window.__figBoxesGroup.some(Q=>Z(Q,at,6))||(window.__dimBoxesGroup||[]).some(Q=>Z(Q,at,3))||(window.__angleBoxesGroup||[]).some(Q=>Z(Q,at,3))||(window.__legendBoxesGroup||[]).some(Q=>Z(Q,at,6))||(window.__placedLetterBoxes||[]).some(Q=>Z(Q,at,2))||at.top<0||at.bottom>c||at.left<0||at.right>m))return T={x:W,y:wt,box:at},!0}return!1}const ut=[{x:v.right+10,priority:1},{x:v.left-10-C.w,priority:1},{x:v.right+15,priority:2},{x:v.left-15-C.w,priority:2},{x:v.right+5,priority:2},{x:v.left-5-C.w,priority:2},{x:v.right+20,priority:3},{x:v.left-20-C.w,priority:3},{x:v.right+25,priority:3},{x:v.left-25-C.w,priority:3},{x:v.right+30,priority:3},{x:v.left-30-C.w,priority:3}];ut.sort((F,U)=>F.priority-U.priority);for(const F of ut){if(T)break;const U=It(F.x,C.w,0,m);if(V(U))break}if(!T){const F=(v.left+v.right)/2,U=[{x:F-C.w/2,y:v.top-C.h-5},{x:F-C.w/2,y:v.bottom+C.h+5}];for(const k of U){if(T)break;const gt=It(k.x,C.w,0,m),mt=Math.max(C.h/2,Math.min(c-C.h/2,k.y)),j=X(gt,mt);!window.__figBoxesGroup.some(W=>Z(W,j,6))&&!(window.__dimBoxesGroup||[]).some(W=>Z(W,j,3))&&!(window.__angleBoxesGroup||[]).some(W=>Z(W,j,3))&&!(window.__legendBoxesGroup||[]).some(W=>Z(W,j,6))&&!(window.__placedLetterBoxes||[]).some(W=>Z(W,j,2))&&j.top>=0&&j.bottom<=c&&j.left>=0&&j.right<=m&&(T={x:gt,y:mt,box:j})}}if(!T){const F=It(m-C.w,C.w,0,m),U=I;T={x:F,y:U,box:X(F,U)}}window.__placedLetterBoxes.push(T.box);const Y=document.createElementNS("http://www.w3.org/2000/svg","text");Y.setAttribute("x",T.x),Y.setAttribute("y",T.y),Y.setAttribute("fill",Rt),Y.setAttribute("font-size",ct),Y.setAttribute("text-anchor","start"),Y.setAttribute("alignment-baseline","middle"),Y.style.fontWeight="600",Y.style.pointerEvents="none",Y.textContent=nt,t.appendChild(Y)}()}),n.innerHTML="",n.appendChild(t)};function $t(){window.setDataSources&&window.setDataSources({sugerencias:window.SUGERENCIAS||{},elementosAgrupados:window.elementosAgrupadosScript||[]});const y=window.elementosAgrupadosScript;if(!y)return;const s=document.getElementById("grid-maquina");if(s&&window.updateGridClasses){const a=JSON.parse(localStorage.getItem("showLeft")??"true"),o=JSON.parse(localStorage.getItem("showRight")??"true");window.updateGridClasses(a,o),console.log("üé® Clases aplicadas ANTES de renderizar SVG")}y.forEach(function(a,o){renderizarGrupoSVG(a,o)}),requestAnimationFrame(()=>{s&&(s.style.opacity="1",s.style.visibility="visible",s.style.transition="opacity 0.2s ease-in, visibility 0s 0s",console.log("‚úÖ Grid visible con clases:",s.className)),document.querySelectorAll(".proceso").forEach(a=>{a.style.opacity="1"})}),window.actualizarSVGConColadas=function(a,o){if(!window.elementosAgrupadosScript)return;const n=window.elementosAgrupadosScript,m=n.findIndex(w=>w.etiqueta&&String(w.etiqueta.etiqueta_sub_id)===String(a));if(m===-1){console.warn(`No se encontr√≥ grupo para etiqueta ${a}`);return}const c=n[m];c.elementos&&o&&c.elementos.forEach(w=>{const t=String(w.id),i=o[t];w.coladas||(w.coladas={colada1:null,colada2:null,colada3:null}),i&&Array.isArray(i)&&(w.coladas.colada1=i[0]||null,w.coladas.colada2=i[1]||null,w.coladas.colada3=i[2]||null)}),renderizarGrupoSVG(c,m),console.log(`‚úÖ SVG actualizado con coladas para etiqueta ${a}`,o)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",$t):$t();document.addEventListener("livewire:navigated",$t);window.abrirModalDividirElemento=function(s){const a=document.getElementById("modalDividirElemento"),o=document.getElementById("dividir_elemento_id"),n=document.getElementById("formDividirElemento");!a||!o||!n||(o.value=s,window.rutaDividirElemento&&n.setAttribute("action",window.rutaDividirElemento),a.classList.remove("hidden"))};window.enviarDivision=async function(){const s=document.getElementById("formDividirElemento"),a=s.getAttribute("action")||window.rutaDividirElemento,o=new FormData(s);try{const n=document.querySelector('meta[name="csrf-token"]'),m=o.get("_token")||(n?n.getAttribute("content"):null),w=await fetch(a,{method:"POST",headers:m?{"X-CSRF-TOKEN":m}:{},body:o}),t=await w.json();if(!w.ok||!t.success)throw new Error(t.message||"Error al dividir");s.reset();const i=document.getElementById("modalDividirElemento");i&&i.classList.add("hidden"),window.Swal?window.Swal.fire("Hecho",t.message,"success"):alert(t.message)}catch(n){window.Swal?window.Swal.fire("Error",n&&n.message||"Error","error"):alert(n&&n.message||"Error")}};(function(y){const s={pendiente:"#ffffff",fabricando:"#facc15",ensamblando:"#facc15",soldando:"#facc15",fabricada:"#22c55e",completada:"#22c55e",ensamblada:"#22c55e",soldada:"#22c55e","en-paquete":"#e3e4FA"},a={pendiente:{cssClass:"estado-pendiente",bgColor:"#ffffff",texto:"Pendiente",icono:"‚è≥"},fabricando:{cssClass:"estado-fabricando",bgColor:"#facc15",texto:"Fabricando",icono:"‚öôÔ∏è"},fabricada:{cssClass:"estado-fabricada",bgColor:"#22c55e",texto:"Fabricada",icono:"‚úÖ"},ensamblando:{cssClass:"estado-ensamblando",bgColor:"#facc15",texto:"Ensamblando",icono:"üîß"},ensamblada:{cssClass:"estado-ensamblada",bgColor:"#22c55e",texto:"Ensamblada",icono:"‚úÖ"},soldando:{cssClass:"estado-soldando",bgColor:"#facc15",texto:"Soldando",icono:"üî•"},soldada:{cssClass:"estado-soldada",bgColor:"#22c55e",texto:"Soldada",icono:"‚úÖ"},completada:{cssClass:"estado-completada",bgColor:"#22c55e",texto:"Completada",icono:"‚úÖ"},empaquetada:{cssClass:"estado-en-paquete",bgColor:"#e3e4FA",texto:"Empaquetada",icono:"üì¶"},"en-paquete":{cssClass:"estado-en-paquete",bgColor:"#e3e4FA",texto:"En Paquete",icono:"üì¶"}};function o(t,i,g={}){console.log(`üîÑ Actualizando etiqueta ${t} a estado: ${i}`);const A=String(t).replace(/\./g,"-"),d=document.querySelector(`#etiqueta-${A}`);if(!d)return console.warn(`‚ùå No se encontr√≥ elemento para etiqueta: ${t}`),!1;const p=String(i).toLowerCase().trim(),l=a[p];if(!l)return console.warn(`‚ö†Ô∏è Estado no reconocido: ${i}`),!1;d.dataset.estado=p,Array.from(d.classList).forEach(e=>{e.startsWith("estado-")&&d.classList.remove(e)}),d.classList.add(l.cssClass),d.style.setProperty("--bg-estado",l.bgColor);const u=d.querySelector('[id^="contenedor-svg-"]');if(u){const e=u.querySelector("svg");e&&(e.style.background=l.bgColor)}const r=d.querySelector(".etiqueta-card")||d;return r&&(r.style.background=l.bgColor),n(d,p),m(d),window.dispatchEvent(new CustomEvent("etiqueta:actualizada",{detail:{etiquetaId:t,estado:p,datosExtra:g}})),console.log(`‚úÖ Etiqueta ${t} actualizada a ${i}`),!0}function n(t,i){const g=t.querySelectorAll(".btn-fabricar"),A=["empaquetada","en-paquete"];g.forEach(d=>{A.includes(i)?(d.disabled=!0,d.style.opacity="0.5",d.style.cursor="not-allowed",d.title=`Etiqueta ya ${i}`):(d.disabled=!1,d.style.opacity="1",d.style.cursor="pointer",d.title="Fabricar esta etiqueta")})}function m(t){t.style.transition="transform 0.5s ease, background-color 0.5s ease",t.style.transform="scale(1.03)",setTimeout(()=>{t.style.transform="scale(1)"},400)}function c(t,i,g={}){console.log(`üîÑ Actualizando ${t.length} etiquetas...`);const d=t.map(p=>o(p,i,g)).filter(p=>p).length;return console.log(`‚úÖ ${d}/${t.length} etiquetas actualizadas`),d}function w(t){const i=String(t).replace(/\./g,"-"),g=document.querySelector(`#etiqueta-${i}`);return g?{id:t,estado:g.dataset.estado||"desconocido",elemento:g}:null}window.addEventListener("paquete:creado",t=>{const{codigoPaquete:i,etiquetaIds:g}=t.detail;console.log(`üì¶ Evento paquete:creado recibido - ${i} con ${g.length} etiquetas`),c(g,"empaquetada",{codigo_paquete:i})}),y.SistemaDOM={actualizarEstadoEtiqueta:o,actualizarMultiplesEtiquetas:c,obtenerEstadoActual:w,ESTADOS_CONFIG:a},y.ColoresEstado={actualizar:(t,i)=>{s[t]=i;const g=document.getElementById("colores-estado-css");if(g){let A=`
/* === Colores de estado (inyectados din√°micamente) === */
.proceso {
    --bg-estado: #e5e7eb;
}
`;for(const[d,p]of Object.entries(s))A+=`.proceso.estado-${d} {
    --bg-estado: ${p};
}
`;g.textContent=A,console.log(`‚úÖ Color actualizado para estado "${t}": ${i}`)}},obtenerColor:t=>s[t],todos:()=>({...s})}})(window);function Tt(){if(window.__trabajoEtiquetaInit)return;window.__trabajoEtiquetaInit=!0,document.addEventListener("click",async t=>{var u,r,e;const i=t.target.closest(".btn-fabricar");if(!i)return;t.preventDefault();const g=(r=(u=document.getElementById("maquina-info"))==null?void 0:u.dataset)==null?void 0:r.maquinaId;if(!g){console.error("No se encontr√≥ #maquina-info o data-maquina-id."),await Swal.fire({icon:"error",title:"Falta la m√°quina",text:"No se pudo determinar la m√°quina de trabajo."});return}const A=String(i.dataset.etiquetaId||"").trim(),d=A.replace(/\./g,"-"),p=document.querySelector(`#etiqueta-${d}`);if(p){const b=(p.dataset.estado||"").toLowerCase();if(["completada","en-paquete","empaquetada"].includes(b)){await Swal.fire({icon:"info",title:"Etiqueta ya completada",text:`La etiqueta ${A} ya est√° en estado ${b}.`,timer:2500,showConfirmButton:!1});return}}const l=Number(((e=window.DIAMETRO_POR_ETIQUETA)==null?void 0:e[A])??0);if(!A){Swal.fire({icon:"error",title:"Etiqueta no v√°lida",text:"Falta el ID de etiqueta."});return}if(!l&&(window.MAQUINA_TIPO||"").toLowerCase()==="barra"){Swal.fire({icon:"error",title:"Di√°metro desconocido",text:"No se pudo determinar el di√°metro de la subetiqueta."});return}const f=i.disabled;i.disabled=!0;try{await y(A,g,l)}finally{i.disabled=f}});async function y(t,i,g=null){var h,M,E,q;const A=`/actualizar-etiqueta/${t}/maquina/${i}`,d=(h=document.querySelector('meta[name="csrf-token"]'))==null?void 0:h.getAttribute("content"),p=t.replace(/\./g,"-"),f=(((E=(M=document.querySelector(`#etiqueta-${p}`))==null?void 0:M.dataset)==null?void 0:E.estado)||"").toLowerCase()==="fabricando",u=(window.MAQUINA_TIPO||"").toLowerCase()==="barra",r=(window.MAQUINA_CODIGO||"").toUpperCase()==="SL28",e=(window.MAQUINA_TIPO_NOMBRE||"").toLowerCase()==="cortadora_manual";if(u&&r||e){if(f&&((q=window._decisionCortePorEtiqueta)!=null&&q[t])){await Cortes.enviarAFabricacionOptimizada({...window._decisionCortePorEtiqueta[t],csrfToken:d,etiquetaId:t,onUpdate:a});return}for(;;){let x;try{x=await Cortes.mejorCorteSimple(t,g,d)}catch(S){w(S);return}if(!x)return;if(x.accion==="optimizar"){let S;try{S=await Cortes.mejorCorteOptimizado(t,g,x.patrones,d)}catch(D){w(D);return}if((S==null?void 0:S.accion)==="fabricar"){window._decisionCortePorEtiqueta=window._decisionCortePorEtiqueta||{},window._decisionCortePorEtiqueta[t]={longitudBarraCm:S.longitudBarraCm,etiquetas:S.etiquetas},localStorage.setItem("decisionCortePorEtiqueta",JSON.stringify(window._decisionCortePorEtiqueta)),await Cortes.enviarAFabricacionOptimizada({...window._decisionCortePorEtiqueta[t],csrfToken:d,etiquetaId:t,onUpdate:a});return}else{if(S==="volver")continue;return}}if(x.accion==="fabricar_patron_simple"){const S=Math.round(Number(x.longitud_m||0)*100);if(!S){w("Longitud de barra no v√°lida.");return}window._decisionCortePorEtiqueta=window._decisionCortePorEtiqueta||{},window._decisionCortePorEtiqueta[t]={longitudBarraCm:S,etiquetas:[{etiqueta_sub_id:t,elementos:[]}]},localStorage.setItem("decisionCortePorEtiqueta",JSON.stringify(window._decisionCortePorEtiqueta)),await Cortes.enviarAFabricacionOptimizada({...window._decisionCortePorEtiqueta[t],csrfToken:d,etiquetaId:t,onUpdate:a});return}return}}if((window.MAQUINA_TIPO_NOMBRE||"").toLowerCase()==="grua"){try{await s(t,i,d)}catch(x){w(x)}return}try{const x=await fetch(A,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":d},body:JSON.stringify({})}),S=await x.json();if(!x.ok)throw new Error(S.message||"Error al actualizar");a(t,S)}catch(x){w(x)}}async function s(t,i,g){var O,v,tt,H;const{value:A,isConfirmed:d}=await Swal.fire({title:"üì¶ Escanear producto",text:"Escanea el QR del paquete de material a usar",input:"text",inputPlaceholder:"C√≥digo del producto...",showCancelButton:!0,confirmButtonText:"Siguiente",cancelButtonText:"Cancelar",confirmButtonColor:"#F97316",inputValidator:B=>{if(!B||!B.trim())return"Debes escanear o introducir el c√≥digo del producto"}});if(!d||!A)return;let p;try{const B=await fetch(`/api/productos/buscar-por-codigo?codigo=${encodeURIComponent(A.trim())}`,{headers:{Accept:"application/json","X-CSRF-TOKEN":g}});if(!B.ok){const N=await B.json();throw new Error(N.message||"Producto no encontrado")}p=await B.json()}catch(B){await Swal.fire({icon:"error",title:"Producto no encontrado",text:B.message||`No se encontr√≥ ning√∫n producto con c√≥digo: ${A}`});return}const l=Number(((O=window.DIAMETRO_POR_ETIQUETA)==null?void 0:O[t])??0),u=Number(((v=window.LONGITUD_POR_ETIQUETA)==null?void 0:v[t])??0)/100,r=Number(p.diametro??0),e=Number(p.longitud??0);if(r>0&&l>0&&Math.abs(r-l)>.1){await Swal.fire({icon:"error",title:"Di√°metro incorrecto",html:`
                    <p>El di√°metro del producto no coincide con el de la etiqueta.</p>
                    <div class="mt-3 p-3 bg-red-50 rounded text-left">
                        <p><strong>Producto:</strong> √ò${r} mm</p>
                        <p><strong>Etiqueta requiere:</strong> √ò${l} mm</p>
                    </div>
                `});return}if(e>0&&u>0&&e<u){await Swal.fire({icon:"error",title:"Longitud insuficiente",html:`
                    <p>La longitud del producto es menor que la requerida por la etiqueta.</p>
                    <div class="mt-3 p-3 bg-red-50 rounded text-left">
                        <p><strong>Producto:</strong> ${e.toFixed(2)} m</p>
                        <p><strong>Etiqueta requiere:</strong> ${u.toFixed(2)} m</p>
                    </div>
                `});return}const b=p.longitud?`${p.longitud} m`:"N/A",{value:h,isConfirmed:M}=await Swal.fire({title:"¬øC√≥mo usar el paquete?",html:`
                <div class="text-left p-4 bg-gray-100 rounded mb-4">
                    <p><strong>Producto:</strong> ${p.codigo}</p>
                    <p><strong>Di√°metro:</strong> √ò${p.diametro} mm</p>
                    <p><strong>Longitud:</strong> ${b}</p>
                    <p><strong>Stock actual:</strong> ${((tt=p.peso_stock)==null?void 0:tt.toFixed(2))||0} kg</p>
                    <p><strong>Colada:</strong> ${p.n_colada||"N/A"}</p>
                </div>
            `,input:"radio",inputOptions:{completo:"üì¶ Usar paquete completo (consumir todo)",parcial:"‚úÇÔ∏è Quitar barras (restar peso de la etiqueta)"},inputValue:"completo",showCancelButton:!0,confirmButtonText:"Fabricar",cancelButtonText:"Cancelar",confirmButtonColor:"#10B981"});if(!M)return;const E=h==="completo",q=`/actualizar-etiqueta/${t}/maquina/${i}`,x=await fetch(q,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":g},body:JSON.stringify({producto_id:p.id,paquete_completo:E})}),S=await x.json();if(!x.ok)throw new Error(S.message||"Error al fabricar");const D=((H=S.metricas)==null?void 0:H.peso_consumido)||0;await Swal.fire({icon:"success",title:"¬°Fabricaci√≥n completada!",html:`
                <p>Etiqueta fabricada correctamente.</p>
                <p><strong>Producto usado:</strong> ${p.codigo}</p>
                <p><strong>Peso consumido:</strong> ${D.toFixed(2)} kg</p>
                ${E?'<p class="text-orange-600">El paquete ha sido marcado como consumido.</p>':""}
            `,timer:3e3,showConfirmButton:!1}),a(t,S)}function a(t,i){var A,d;const g=t.replace(/\./g,"-");switch(console.log("üîç DEBUG actualizarDOMEtiqueta - Datos recibidos:",{id:t,estado:i.estado,peso_etiqueta:i.peso_etiqueta,nombre:i.nombre,data_completa:i}),typeof window.SistemaDOM<"u"?window.SistemaDOM.actualizarEstadoEtiqueta(t,i.estado,{peso:i.peso_etiqueta,nombre:i.nombre||t}):o(t,i.estado),i.coladas_por_elemento&&typeof window.actualizarSVGConColadas=="function"&&window.actualizarSVGConColadas(t,i.coladas_por_elemento),(i.estado||"").toLowerCase()){case"cortando":c("info","Cortando","El proceso de corte ha iniciado.");break;case"cortada":c("success","Etiqueta cortada","El proceso de corte ha finalizado correctamente."),n(g);break;case"fabricando":c("info","Fabricando","El proceso de fabricaci√≥n ha iniciado.");break;case"fabricada":c("success","Etiqueta fabricada","La etiqueta ha sido fabricada exitosamente."),n(g),typeof window.TrabajoPaquete<"u"&&window.TrabajoPaquete.agregarItemEtiqueta(t,{id:t,peso_etiqueta:i.peso_etiqueta||0,estado:"fabricada",nombre:i.nombre||t}),i.elementos&&Array.isArray(i.elementos)&&i.elementos.length>0?i.elementos.some(l=>l.coladas&&(l.coladas.colada1||l.coladas.colada2||l.coladas.colada3))?(console.log(`üîÑ Actualizando coladas para etiqueta ${t}`,i.elementos),m(t,i.elementos)):console.warn(`‚ö†Ô∏è No se encontraron coladas en elementos para etiqueta ${t}`):console.warn(`‚ö†Ô∏è No se recibieron elementos v√°lidos para actualizar coladas en etiqueta ${t}`);break;case"completada":c("success","Etiqueta completada","La etiqueta ha sido procesada exitosamente."),(A=window._decisionCortePorEtiqueta)!=null&&A[t]&&(delete window._decisionCortePorEtiqueta[t],localStorage.setItem("decisionCortePorEtiqueta",JSON.stringify(window._decisionCortePorEtiqueta))),n(g),typeof window.TrabajoPaquete<"u"&&window.TrabajoPaquete.agregarItemEtiqueta(t,{id:t,peso_etiqueta:i.peso_etiqueta||0,estado:"completada",nombre:i.nombre||t}),i.elementos&&Array.isArray(i.elementos)&&i.elementos.length>0?i.elementos.some(l=>l.coladas&&(l.coladas.colada1||l.coladas.colada2||l.coladas.colada3))?(console.log(`üîÑ Actualizando coladas para etiqueta ${t}`,i.elementos),m(t,i.elementos)):console.warn(`‚ö†Ô∏è No se encontraron coladas en elementos para etiqueta ${t}`):console.warn(`‚ö†Ô∏è No se recibieron elementos v√°lidos para actualizar coladas en etiqueta ${t}`);break;case"ensamblando":c("info","Ensamblando","La etiqueta est√° en proceso de ensamblado.");break;case"ensamblada":c("success","Etiqueta ensamblada","El proceso de ensamblado ha finalizado correctamente."),n(g);break;case"soldando":c("info","Soldando","La etiqueta est√° en proceso de soldadura.");break;case"soldada":c("success","Etiqueta soldada","El proceso de soldadura ha finalizado correctamente."),n(g);break;default:console.warn(`Estado no manejado para etiqueta ${t}: ${i.estado}`),c("warning","Estado desconocido",`El estado recibido (${i.estado}) no est√° reconocido.`,3e3)}(d=i.productos_afectados)!=null&&d.length&&i.productos_afectados.forEach(p=>{const l=document.getElementById(`peso-stock-${p.id}`),f=document.getElementById(`progreso-texto-${p.id}`),u=document.getElementById(`progreso-barra-${p.id}`);l&&(l.textContent=`${p.peso_stock} kg`),f&&(f.textContent=`${p.peso_stock} / ${p.peso_inicial} kg`),u&&(u.style.height=`${p.peso_stock/p.peso_inicial*100}%`)})}function o(t,i){const g=t.replace(/\./g,"-"),A=document.getElementById("etiqueta-"+g);if(!A)return;A.dataset.estado=String(i||"").toLowerCase(),A.className=A.className.split(" ").filter(l=>!l.startsWith("estado-")).join(" ").trim(),A.classList.add("estado-"+A.dataset.estado);const d=A.querySelector('[id^="contenedor-svg-"]'),p=d==null?void 0:d.querySelector("svg");p&&(p.style.background=getComputedStyle(A).getPropertyValue("--bg-estado").trim())}function n(t){const i=`#etiqueta-${CSS.escape(t)}`,g=document.querySelector(i),A=Array.from(document.querySelectorAll(".proceso")),d=b=>(b||"").normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim().toLowerCase(),p=b=>{var E;const h=(E=b.dataset)==null?void 0:E.estado;if(h)return d(h);const M=b.querySelector('[id^="estado-"]');return d((M==null?void 0:M.textContent)||(M==null?void 0:M.innerText)||"")},l=new Set(["completada","completado","finalizada","finalizado","terminada","terminado","hecha","hecho","empaquetada","en-paquete"]),f=b=>l.has(p(b)),u=g?A.indexOf(g):-1,e=(u>=0?A.slice(u+1):A).find(b=>!f(b));e?e.scrollIntoView({behavior:"smooth",block:"center"}):Swal.fire({icon:"success",title:"¬°Perfecto!",text:"Has terminado todas las etiquetas de esta planilla.",showConfirmButton:!0})}function m(t,i){var l;if(console.log(`üîÑ Actualizando coladas en SVG para etiqueta ${t}`),!i||!Array.isArray(i)){console.error(`‚ùå elementosActualizados no es un array v√°lido para etiqueta ${t}`);return}if(i.length===0){console.warn(`‚ö†Ô∏è elementosActualizados est√° vac√≠o para etiqueta ${t}`);return}if(!window.elementosAgrupadosScript||!Array.isArray(window.elementosAgrupadosScript)){console.error("‚ùå window.elementosAgrupadosScript no est√° disponible");return}const g=window.elementosAgrupadosScript.findIndex(f=>{var u;return((u=f.etiqueta)==null?void 0:u.etiqueta_sub_id)===t});if(g===-1){console.warn(`‚ö†Ô∏è No se encontr√≥ grupo para etiqueta ${t}`);return}window.elementosAgrupadosScript[g].elementos=i;const A=window.elementosAgrupadosScript[g],d=(l=A.etiqueta)==null?void 0:l.id;if(!d){console.error(`‚ùå No se pudo obtener groupId para etiqueta ${t}`);return}const p=document.getElementById("contenedor-svg-"+d);if(!p){console.warn(`‚ö†Ô∏è No se encontr√≥ contenedor SVG para etiqueta ${t} (id: ${d})`);return}try{const f=p.querySelector("svg");f&&f.remove();const u=600,r=150,e=p.closest(".proceso"),b=e&&getComputedStyle(e).getPropertyValue("--bg-estado").trim()||"#e5e7eb",h=document.createElementNS("http://www.w3.org/2000/svg","svg");h.setAttribute("viewBox",`0 0 ${u} ${r}`),h.setAttribute("preserveAspectRatio","xMidYMid meet"),h.style.width="100%",h.style.height="100%",h.style.display="block",h.style.background=b;const M=(A.elementos||[]).map((q,x)=>{var tt,H,B;const S=q.barras!=null?q.barras:0;let D="N/A";if(q.diametro!=null&&q.diametro!==""){const R=String(q.diametro).replace(",",".").match(/-?\d+(?:\.\d+)?/);if(R){const L=parseFloat(R[0]);isFinite(L)&&(D=String(Math.round(L)))}}const O=[];(tt=q.coladas)!=null&&tt.colada1&&O.push(q.coladas.colada1),(H=q.coladas)!=null&&H.colada2&&O.push(q.coladas.colada2),(B=q.coladas)!=null&&B.colada3&&O.push(q.coladas.colada3);const v=O.length>0?` (${O.join(", ")})`:"";return{letter:indexToLetters(x),text:`√ò${D} x${S}${v}`}});typeof drawLegendBottomLeft=="function"?drawLegendBottomLeft(h,M,u,r):console.error("‚ùå drawLegendBottomLeft no est√° definida");const E=document.createElementNS("http://www.w3.org/2000/svg","text");E.setAttribute("x",u/2),E.setAttribute("y",r/2),E.setAttribute("text-anchor","middle"),E.setAttribute("fill","#059669"),E.setAttribute("font-size","14"),E.setAttribute("font-weight","600"),E.textContent="‚úì Coladas actualizadas",h.appendChild(E),p.appendChild(h),console.log(`‚úÖ SVG actualizado con coladas para etiqueta ${t}`),setTimeout(()=>{E&&E.parentNode&&E.remove()},2e3)}catch(f){console.error(`‚ùå Error al actualizar SVG para etiqueta ${t}:`,f),typeof Swal<"u"&&Swal.fire({icon:"warning",title:"Advertencia",text:"Las coladas se guardaron pero hubo un problema al actualizar la visualizaci√≥n.",timer:3e3,showConfirmButton:!1})}}function c(t,i,g,A=2e3){Swal.fire({icon:t,title:i,text:g,timer:A,showConfirmButton:!1})}function w(t){Swal.fire({icon:"error",title:"Error",text:t.message||"Ha ocurrido un error inesperado"})}window.actualizarDOMEtiqueta=a}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Tt):Tt();document.addEventListener("livewire:navigated",Tt);(function(y){let s=[],a=!1,o=null;async function n(f){var r;const u=`/etiquetas/${encodeURIComponent(f)}/validar-para-paquete`;try{const e=await fetch(u,{method:"GET",headers:{Accept:"application/json","X-CSRF-TOKEN":(r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.content}});if(!(e.headers.get("content-type")||"").includes("application/json"))throw new Error("Respuesta del servidor no es JSON");const h=await e.json();if(console.log("üîç validarEtiqueta response:",{status:e.status,data:h,peso_etiqueta:h.peso_etiqueta}),!e.ok)throw new Error((h==null?void 0:h.message)||(h==null?void 0:h.motivo)||"Error al validar");return h}catch(e){throw e}}function m(f,u){const r=u.id||f;if(s.some(h=>h.id===r))return!1;const e=parseFloat(u.peso_etiqueta)||0;console.log("üîç agregarItemEtiqueta:",{codigo:f,id:r,peso_etiqueta_recibido:u.peso_etiqueta,peso_parseado:e,data_completa:u});const b={id:r,type:"etiqueta",peso:e,estado:u.estado||"desconocido",nombre:u.nombre||"Sin nombre"};return s.push(b),g(),!0}function c(f){const u=s.findIndex(r=>r.id===f);u>=0&&s.splice(u,1),g()}function w(){s=[],g()}function t(){return s.reduce((f,u)=>f+(parseFloat(u.peso)||0),0)}function i(){return s}function g(){const f=document.getElementById("itemsList");if(!f)return;f.innerHTML="";for(const e of s){const b=document.createElement("li");b.className="flex justify-between items-center px-3 py-2 bg-white border rounded mb-2",b.dataset.code=e.id,b.innerHTML=`
                <div>
                    <div class="font-semibold">${e.id} === ${e.peso.toFixed(2)} kg</div>
                </div>
                <button class="text-red-600 hover:text-red-800" title="Eliminar">‚ùå</button>
            `,b.querySelector("button").onclick=()=>c(e.id),f.appendChild(b)}const u=t(),r=document.createElement("li");r.className="py-3 px-3 bg-blue-50 border-t-2 mt-3 font-bold",r.textContent=`Total: ${u.toFixed(2)} kg (${s.length} etiquetas)`,f.appendChild(r)}async function A(){var b,h,M;if(!s.length){await Swal.fire("Carro vac√≠o","No hay etiquetas para empaquetar","warning");return}const f=Number(((h=(b=document.getElementById("maquina-info"))==null?void 0:b.dataset)==null?void 0:h.maquinaId)||window.maquinaId),u=Number(((M=document.getElementById("ubicacion-id"))==null?void 0:M.value)||window.ubicacionId);if(!f||!u){await Swal.fire("Faltan datos","Debe especificarse la m√°quina y la ubicaci√≥n.","error");return}const r={items:s.map(E=>({id:E.id,type:E.type})),maquina_id:f,ubicacion_id:u},e=async(E={})=>{var S;const q=await fetch("/paquetes",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":(S=document.querySelector('meta[name="csrf-token"]'))==null?void 0:S.content},body:JSON.stringify({...r,...E})}),x=await q.json();if(!q.ok)throw new Error(x.message||"Error al crear el paquete");return x};try{const E=await e();if(E.success)return d(E);if(E.warning){let q="<div style='text-align:left;'>Se detectaron advertencias:";for(const[S,D]of Object.entries(E.warning))Array.isArray(D)&&D.length&&(q+=`<br><strong>${S.replaceAll("_"," ")}:</strong> ${D.join(", ")}`);if(q+="</div>",(await Swal.fire({icon:"warning",title:"Advertencias",html:q,showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"})).isConfirmed){const S=await e({confirmar:!0});if(S.success)return d(S);throw new Error(S.message)}throw new Error("Operaci√≥n cancelada por el usuario.")}throw new Error("No se pudo crear el paquete")}catch(E){await Swal.fire("Error",E.message||"Error inesperado","error")}}async function d(f){var b;const u=f.codigo_paquete||((b=f.paquete)==null?void 0:b.codigo)||"N/D",r=t(),e=[...s.map(h=>h.id)];await Swal.fire({icon:"success",title:"Paquete creado",html:`<p><strong>${u}</strong> creado correctamente</p><p>${e.length} etiquetas ¬∑ ${r.toFixed(2)} kg</p>`}),w(),console.log(`üì¶ Disparando evento paquete:creado para ${u}`),window.dispatchEvent(new CustomEvent("paquete:creado",{detail:{codigoPaquete:u,etiquetaIds:e,pesoTotal:r}})),typeof window.SistemaDOM>"u"?(console.log("‚ö†Ô∏è SistemaDOM no disponible, actualizando manualmente"),e.forEach(h=>{p(h,u)})):console.log("‚úÖ SistemaDOM detectado, se actualizar√° autom√°ticamente")}function p(f,u){const r=String(f).replace(/\./g,"-"),e=document.querySelector(`#etiqueta-${r}`);if(!e){console.warn(`‚ùå No se encontr√≥ elemento: ${f}`);return}console.log(`üîÑ Actualizando manualmente: ${f}`),Array.from(e.classList).forEach(x=>{x.startsWith("estado-")&&e.classList.remove(x)}),e.classList.add("estado-en-paquete"),e.dataset.estado="en-paquete",e.style.setProperty("--bg-estado","#e3e4FA");const h=e.querySelector('[id^="contenedor-svg-"]');if(h){const x=h.querySelector("svg");x&&(x.style.background="#e3e4FA")}const M=e.querySelector(".etiqueta-card")||e;M&&(M.style.background="#e3e4FA");const E=e.querySelector("h3");if(E&&!e.querySelector(".paquete-info")){const x=document.createElement("div");x.className="paquete-info text-sm font-semibold mt-2 no-print",x.style.cssText="display: flex; align-items: center; gap: 0.25rem; color: #7c3aed; font-size: 0.875rem;",x.innerHTML=`
                <svg style="width: 1rem; height: 1rem;" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                </svg>
                <span>Paquete: ${u}</span>
            `,E.parentNode.insertBefore(x,E.nextSibling)}e.querySelectorAll(".btn-fabricar").forEach(x=>{x.disabled=!0,x.style.opacity="0.5",x.style.cursor="not-allowed"}),e.style.transition="transform 0.5s ease, background-color 0.5s ease",e.style.transform="scale(1.03)",setTimeout(()=>{e.style.transform="scale(1)"},400),console.log(`‚úÖ Etiqueta ${f} actualizada manualmente`)}function l(){if(a)return;a=!0;const f=document.getElementById("qrItem");f&&(f.addEventListener("change",()=>f.dispatchEvent(new Event("input"))),f.addEventListener("input",async function(){const r=this.value.trim();if(r)try{const e=await n(r);if(!e.valida){await Swal.fire("Etiqueta no v√°lida",e.motivo||"Motivo no especificado","warning"),this.value="",this.focus();return}m(r,e)||await Swal.fire("Etiqueta duplicada","Ya est√° en el carro","info"),this.value="",this.focus()}catch(e){console.error("Error de validaci√≥n:",e),await Swal.fire("Error",e.message||"Fallo en validaci√≥n","error"),this.value="",this.focus()}}));const u=document.getElementById("crearPaqueteBtn");u&&u.addEventListener("click",A),document.addEventListener("focus",function(r){r.target.id&&r.target.id.startsWith("input-etiqueta-")&&(o=r.target,console.log("üéØ Focus en input:",r.target.id))},!0),document.addEventListener("click",async function(r){var e;if(r.target.classList.contains("btn-agregar-carro")||r.target.closest(".btn-agregar-carro")){const h=(r.target.classList.contains("btn-agregar-carro")?r.target:r.target.closest(".btn-agregar-carro")).dataset.etiquetaId;if(!h){console.error("No se encontr√≥ etiqueta_id en el bot√≥n");return}const M=document.querySelector(`[x-show="tabActivo === 'crear'"]`),E=document.querySelector(`[x-show="tabActivo === 'gestion'"]`);if(M&&window.getComputedStyle(M).display,E&&window.getComputedStyle(E).display!=="none"){console.log("üì¶ Modo Gesti√≥n: A√±adiendo al input de a√±adir etiqueta");let x=document.activeElement;(!x||!((e=x.id)!=null&&e.startsWith("input-etiqueta-")))&&(x=o),(!x||!document.body.contains(x))&&(x=document.querySelector('input[id^="input-etiqueta-"]')),x?(x.value=h,x.focus(),x.classList.add("ring-4","ring-green-400"),setTimeout(()=>{x.classList.remove("ring-4","ring-green-400")},1e3),console.log(`‚úÖ Etiqueta ${h} a√±adida al input:`,x.id)):await Swal.fire({icon:"info",title:"Expande un paquete",text:"Para a√±adir una etiqueta, primero expande el paquete donde deseas a√±adirla"});return}console.log("üõí Modo Crear: A√±adiendo etiqueta al carro:",h);try{const x=await n(h);if(!x.valida){await Swal.fire({icon:"warning",title:"Etiqueta no v√°lida",text:x.motivo||"Motivo no especificado"});return}m(h,x)||await Swal.fire({icon:"info",title:"Etiqueta duplicada",text:"Ya est√° en el carro"})}catch(x){console.error("Error al a√±adir al carro:",x),await Swal.fire({icon:"error",title:"Error",text:x.message||"No se pudo a√±adir al carro"})}}})}y.TrabajoPaquete={inicializar:l,agregarItemEtiqueta:m,eliminarItem:c,limpiarCarro:w,obtenerItems:i,calcularPesoTotal:t,crearPaquete:A,validarEtiqueta:n,actualizarListaVisual:g},document.readyState==="loading"?document.addEventListener("DOMContentLoaded",l):l(),document.addEventListener("livewire:navigated",l)})(window);function Nt(){document.addEventListener("alpine:init",()=>{window.updateGridClasses=function(s,a){const o=document.getElementById("grid-maquina");if(!o)return;console.log("üîß Actualizando clases:",{showLeft:s,showRight:a,clasesAnteriores:o.className}),s||a?o.classList.add("columnas-laterales-visibles"):o.classList.remove("columnas-laterales-visibles"),s&&a?o.classList.add("ambas-columnas"):o.classList.remove("ambas-columnas"),console.log("‚úÖ Clases actualizadas:",o.className),o.offsetHeight,o.querySelectorAll(".etiqueta-card").forEach(m=>{m.offsetHeight}),console.log("üé® Repaint forzado (optimizado)")},window.addEventListener("toggleLeft",()=>{const s=JSON.parse(localStorage.getItem("showLeft")??"true"),a=JSON.parse(localStorage.getItem("showRight")??"true");window.updateGridClasses(s,a)}),window.addEventListener("solo",()=>{window.updateGridClasses(!1,!1)}),window.addEventListener("toggleRight",()=>{const s=JSON.parse(localStorage.getItem("showLeft")??"true"),a=JSON.parse(localStorage.getItem("showRight")??"true");window.updateGridClasses(s,a)});function y(){if(!document.getElementById("grid-maquina")){console.log("‚è≥ Grid no encontrado, reintentando..."),new MutationObserver((m,c)=>{if(document.getElementById("grid-maquina")){console.log("‚úÖ Grid detectado por MutationObserver"),c.disconnect();const t=JSON.parse(localStorage.getItem("showLeft")??"true"),i=JSON.parse(localStorage.getItem("showRight")??"true");window.updateGridClasses(t,i)}}).observe(document.body,{childList:!0,subtree:!0});return}const a=JSON.parse(localStorage.getItem("showLeft")??"true"),o=JSON.parse(localStorage.getItem("showRight")??"true");window.updateGridClasses(a,o),console.log("‚úÖ Clases iniciales aplicadas inmediatamente")}y()})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Nt):Nt();document.addEventListener("livewire:navigated",Nt);

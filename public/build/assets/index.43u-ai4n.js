const $=()=>window.AppPlanif,B=()=>$().csrf,E=()=>$().routes,M=()=>({maquinas:$().maquinas,eventos:$().eventos});let _=null;function y(){_&&(_.remove(),_=null,document.removeEventListener("click",y),document.removeEventListener("scroll",y,!0),window.removeEventListener("resize",y))}function D(l,d,r){y();const s=document.createElement("div");s.className="fc-contextmenu",Object.assign(s.style,{position:"fixed",zIndex:9999,minWidth:"240px",background:"#fff",border:"1px solid #e5e7eb",boxShadow:"0 10px 15px -3px rgba(0,0,0,.1), 0 4px 6px -2px rgba(0,0,0,.05)",borderRadius:"8px",overflow:"hidden",visibility:"hidden"}),s.innerHTML=r,document.body.appendChild(s);const i=s.getBoundingClientRect(),b=window.innerHeight,c=window.innerWidth;let f=d;d+i.height>b&&(f=d-i.height,f<0&&(f=Math.max(0,b-i.height)));let t=l;return l+i.width>c&&(t=l-i.width,t<0&&(t=Math.max(0,c-i.width))),Object.assign(s.style,{top:f+"px",left:t+"px",visibility:"visible"}),_=s,setTimeout(()=>{document.addEventListener("click",y),document.addEventListener("scroll",y,!0),window.addEventListener("resize",y)},0),s}function q(l,d,{headerHtml:r="",items:s=[]}){const i=`
    <div class="ctx-menu-container">
      ${r?`<div class="ctx-menu-header">${r}</div>`:""}
      ${s.map((c,f)=>`
        <button class="ctx-menu-item${c.danger?" ctx-menu-danger":""}${c.disabled?" ctx-menu-disabled":""}" data-idx="${f}" ${c.disabled?"disabled":""}>
          ${c.icon?`<span class="ctx-menu-icon">${c.icon}</span>`:""}
          <span class="ctx-menu-label">${c.label}</span>
        </button>
      `).join("")}
    </div>
  `,b=D(l,d,i);return b.querySelectorAll(".ctx-menu-item").forEach(c=>{const f=parseInt(c.dataset.idx,10),t=s[f];c.addEventListener("click",async o=>{if(o.preventDefault(),o.stopPropagation(),console.log("[baseMenu] Click en item:",t.label,"disabled:",t.disabled),t.disabled){console.log("[baseMenu] Item deshabilitado, ignorando");return}const e=t.onClick;console.log("[baseMenu] Ejecutando acci√≥n..."),y();try{await(e==null?void 0:e()),console.log("[baseMenu] Acci√≥n completada")}catch(n){console.error("[baseMenu] Error en acci√≥n:",n)}})}),b}async function k(l,d={}){const r={headers:{Accept:"application/json","X-CSRF-TOKEN":B()},...d};r.body&&typeof r.body!="string"&&(r.headers["Content-Type"]="application/json",r.body=JSON.stringify(r.body));const s=await fetch(l,r);let i=null;try{i=await s.json()}catch{}if(!s.ok)throw new Error((i==null?void 0:i.message)||`HTTP ${s.status}`);return i}async function A(l){const d=await Swal.fire({title:"Nuevo festivo",input:"text",inputLabel:"T√≠tulo del festivo",inputValue:"Festivo",showCancelButton:!0,confirmButtonText:"Crear",cancelButtonText:"Cancelar",inputValidator:s=>!s||!s.trim()?"Pon un t√≠tulo":void 0});return d.isConfirmed?(await k(E().festivo.store,{method:"POST",body:{fecha:l,titulo:d.value.trim()}})).festivo:null}async function L(l,d,r){let s=[],i=[],b=[];try{const n=await fetch(`/api/usuarios/operarios-agrupados?fecha=${l}&maquina_id=${d}`,{headers:{"X-CSRF-TOKEN":window.AppPlanif.csrf,Accept:"application/json"}});if(n.ok){const u=await n.json();s=u.todos||[],i=u.sin_turno||[],b=u.de_maquina||[]}else console.error("Error al obtener operarios:",n.status)}catch(n){console.error("Error al obtener operarios:",n)}const c=(n,u="No hay trabajadores")=>n.length===0?`<option value="" disabled>${u}</option>`:n.map(a=>`<option value="${a.id}">${a.name} ${a.primer_apellido||""} ${a.segundo_apellido||""}</option>`).join(""),f=c(i,"No hay operarios sin turno este d√≠a"),t=c(s,"No hay operarios disponibles"),o=c(b,"No hay operarios asignados a esta m√°quina"),{value:e}=await Swal.fire({title:"üîß Generar Turnos",html:`
            <div class="text-left space-y-4">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                    <p class="text-sm text-blue-800">
                        <strong>Fecha inicio:</strong> ${l}<br>
                        <strong>M√°quina:</strong> ${r}
                    </p>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        Sin turno asignado este d√≠a <span class="text-green-600">(${i.length})</span>
                    </label>
                    <select id="swal-trabajador-sin-turno" class="swal2-input w-full">
                        <option value="" selected>Seleccionar...</option>
                        ${f}
                    </select>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        Asignados a ${r} <span class="text-blue-600">(${b.length})</span>
                    </label>
                    <select id="swal-trabajador-maquina" class="swal2-input w-full">
                        <option value="" selected>Seleccionar...</option>
                        ${o}
                    </select>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        Todos los operarios <span class="text-gray-600">(${s.length})</span>
                    </label>
                    <select id="swal-trabajador-todos" class="swal2-input w-full">
                        <option value="" selected>Seleccionar...</option>
                        ${t}
                    </select>
                </div>

                <input type="hidden" id="swal-trabajador" value="" />

                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        Alcance de generaci√≥n <span class="text-red-500">*</span>
                    </label>
                    <select id="swal-alcance" class="swal2-input w-full">
                        <option value="un_dia">Solo este d√≠a (${l})</option>
                        <option value="resto_a√±o">Desde ${l} hasta fin de a√±o</option>
                    </select>
                </div>

                <div class="mb-4" id="turno-inicio-container" style="display: none;">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        Turno inicial (para diurnos) <span class="text-red-500">*</span>
                    </label>
                    <select id="swal-turno-inicio" class="swal2-input w-full">
                        <option value="ma√±ana">Ma√±ana</option>
                        <option value="tarde">Tarde</option>
                    </select>
                    <p class="text-xs text-gray-500 mt-1">Los turnos alternar√°n cada viernes</p>
                </div>

                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                    <p class="text-xs text-yellow-800">
                        <strong>Nota:</strong> Se saltar√°n autom√°ticamente s√°bados, domingos, festivos y d√≠as con vacaciones.
                    </p>
                </div>
            </div>
        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Generar Turnos",cancelButtonText:"Cancelar",confirmButtonColor:"#3b82f6",cancelButtonColor:"#6b7280",width:"600px",didOpen:()=>{const n=document.getElementById("swal-trabajador"),u=document.getElementById("turno-inicio-container"),a=document.getElementById("swal-trabajador-sin-turno"),w=document.getElementById("swal-trabajador-maquina"),m=document.getElementById("swal-trabajador-todos"),p=[...i,...b,...s];function v(g,S){n.value=g,S!==a&&(a.value=""),S!==w&&(w.value=""),S!==m&&(m.value="");const h=p.find(x=>x.id===parseInt(g));h&&h.turno==="diurno"?u.style.display="block":u.style.display="none"}a.addEventListener("change",g=>{g.target.value&&v(g.target.value,a)}),w.addEventListener("change",g=>{g.target.value&&v(g.target.value,w)}),m.addEventListener("change",g=>{g.target.value&&v(g.target.value,m)})},preConfirm:()=>{const n=document.getElementById("swal-trabajador").value,u=document.getElementById("swal-alcance").value,a=document.getElementById("swal-turno-inicio").value;return n?{trabajador_id:n,alcance:u,turno_inicio:a}:(Swal.showValidationMessage("Debes seleccionar un trabajador"),!1)}});if(!e)return null;try{const u=[...i,...b,...s].find(p=>p.id===parseInt(e.trabajador_id)),w=await fetch("/profile/generar-turnos-calendario",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":window.AppPlanif.csrf,Accept:"application/json"},body:JSON.stringify({user_id:e.trabajador_id,maquina_id:d,fecha_inicio:l,alcance:e.alcance,turno_inicio:e.turno_inicio})}),m=await w.json();if(!w.ok)throw new Error(m.message||`Error HTTP ${w.status}`);return{...m,eventos:m.eventos||[]}}catch(n){return console.error("Error al generar turnos:",n),await Swal.fire({icon:"error",title:"Error",text:n.message||"No se pudieron generar los turnos",confirmButtonText:"Aceptar"}),null}}async function P({fromISO:l,toISO:d,calendar:r}){var t,o;if(!await Swal.fire({icon:"question",title:"Copiar registros",html:`¬øCopiar registros de <b>${l}</b> a <b>${d}</b>?`,showCancelButton:!0,confirmButtonText:"Copiar",cancelButtonText:"Cancelar"}).then(e=>e.isConfirmed))return;const i=r.getEvents().filter(e=>{var n;return!((n=e.extendedProps)!=null&&n.es_festivo)}),b=(e,n,u)=>i.some(a=>{var m,p,v,g;const w=((p=(m=a.getResources)==null?void 0:m.call(a)[0])==null?void 0:p.id)??((v=a.extendedProps)==null?void 0:v.resourceId)??null;return a.title===e&&String(w)===String(n)&&(a.startStr||((g=a.start)==null?void 0:g.toISOString())).slice(0,10)===u}),c=i.filter(e=>{var n;return(e.startStr||((n=e.start)==null?void 0:n.toISOString())).slice(0,10)===l});let f=0;for(const e of c){const n=e.getResources?e.getResources():[],u=((t=n==null?void 0:n[0])==null?void 0:t.id)??((o=e.extendedProps)==null?void 0:o.resourceId)??null,a=e.start?new Date(e.start):null,w=e.end?new Date(e.end):null,m=a?`${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`:"08:00",p=w?`${String(w.getHours()).padStart(2,"0")}:${String(w.getMinutes()).padStart(2,"0")}`:null,v=new Date(`${d}T${m}:00`),g=p?new Date(`${d}T${p}:00`):null;b(e.title,u,d)||(r.addEvent({id:`tmp-copy-${Date.now()}-${Math.random().toString(36).slice(2)}`,title:e.title,start:v.toISOString(),end:g?g.toISOString():null,resourceId:u??void 0,allDay:e.allDay,backgroundColor:e.backgroundColor,borderColor:e.borderColor,textColor:e.textColor,extendedProps:{...e.extendedProps}}),f++)}Swal.fire({icon:"success",title:"Copiado completado",html:`Se han creado <b>${f}</b> registros en ${d}.`,timer:1400,showConfirmButton:!1})}function O(l,d,{fechaISO:r,resourceId:s},i,b){var u;const c=new Date(r);c.setDate(c.getDate()-1);const f=new Date(r);f.setDate(f.getDate()+1);const t=c.toISOString().slice(0,10),o=f.toISOString().slice(0,10),e=s?((u=b.find(a=>String(a.id)===String(s)))==null?void 0:u.title)||`M√°quina ${s}`:"Seleccione una m√°quina",n=[{icon:"üìÖ",label:"Crear festivo este d√≠a",onClick:async()=>{const a=await A(r);if(!a)return;const w=new Date(a.fecha+"T00:00:00"),m=new Date(w);m.setDate(m.getDate()+1);const p=(b||[]).map(v=>v.id);i.addEvent({id:"festivo-"+a.id,title:a.titulo,start:w.toISOString(),end:m.toISOString(),allDay:!0,resourceIds:p,backgroundColor:"#ff0000",borderColor:"#b91c1c",textColor:"#ffffff",editable:!0,classNames:["evento-festivo"],extendedProps:{es_festivo:!0,festivo_id:a.id,entrada:null,salida:null}}),Swal.fire({icon:"success",title:"Festivo creado",timer:1200,showConfirmButton:!1})}},{icon:"‚¨ÖÔ∏è",label:`Copiar registros del d√≠a anterior (${t} ‚Üí ${r})`,onClick:()=>P({fromISO:t,toISO:r,calendar:i})},{icon:"‚û°Ô∏è",label:`Copiar registros del d√≠a siguiente (${o} ‚Üí ${r})`,onClick:()=>P({fromISO:o,toISO:r,calendar:i})},{icon:"üîß",label:s?`Generar turnos para ${e}`:"Generar turnos (seleccione una m√°quina)",disabled:!s,onClick:async()=>{var w;if(console.log("[menu] Click en generar turnos, resourceId:",s),!s){console.log("[menu] No hay resourceId, mostrando advertencia"),Swal.fire({icon:"warning",title:"M√°quina no seleccionada",text:"Haz clic derecho sobre una m√°quina espec√≠fica para generar turnos."});return}console.log("[menu] Llamando a generarTurnosDialog...");const a=await L(r,s,e);if(console.log("[menu] Resultado del di√°logo:",a),a&&a.eventos){console.log("[menu] Procesando eventos:",a.eventos.length);const m=(w=a.eventos[0])==null?void 0:w.user_id;if(m){const p=i.getEvents(),v=a.eventos.map(g=>g.start);p.forEach(g=>{var x,T,C,j;const S=(x=g.extendedProps)==null?void 0:x.user_id,h=((T=g.startStr)==null?void 0:T.slice(0,10))||((C=g.start)==null?void 0:C.toISOString().slice(0,10));S===m&&v.includes(h)&&!((j=g.extendedProps)!=null&&j.es_festivo)&&(console.log("[menu] Eliminando evento antiguo:",g.id),g.remove())})}a.eventos.forEach(p=>{i.addEvent({id:p.id,title:p.title,start:p.start,resourceId:p.resourceId,allDay:!0,backgroundColor:p.backgroundColor,borderColor:p.borderColor,textColor:p.textColor||"#000000",extendedProps:{user_id:p.user_id,categoria_nombre:p.categoria_nombre,turno:p.turno,entrada:p.entrada,salida:p.salida,foto:p.foto,es_festivo:!1}})}),console.log("[menu] Eventos actualizados correctamente")}}}];q(l,d,{headerHtml:`<div>Acciones para <b>${r}</b></div>`,items:n})}function N(l,d,{event:r,titulo:s}){D(l,d,`
    <div style="padding:10px 12px; font-size:13px; color:#6b7280; border-bottom:1px solid #f3f4f6;">
      ${s}
    </div>
    <button id="ctx-eliminar-festivo" style="display:block;width:100%;text-align:left;padding:10px 12px;font-size:14px;background:#fff;border:none;cursor:pointer;">
      üóëÔ∏è Eliminar festivo
    </button>
  `).querySelector("#ctx-eliminar-festivo").addEventListener("click",async()=>{if(y(),!await Swal.fire({icon:"warning",title:"Eliminar festivo",html:`<div>¬øSeguro que quieres eliminar <b>${s}</b>?</div>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(f=>f.isConfirmed))return;const c=r.extendedProps.festivo_id;await k(E().festivo.delete.replace("__ID__",c),{method:"DELETE"}),r.remove(),Swal.fire({icon:"success",title:"Festivo eliminado",timer:1200,showConfirmButton:!1})})}async function R(l){const d=l.extendedProps||{},r=d.entrada||"",s=d.salida||"",i=await Swal.fire({title:"Editar fichaje",html:`
      <div class="flex flex-col gap-3">
        <label class="text-left text-sm">Entrada</label>
        <input id="entradaHora" type="time" class="swal2-input" value="${r}">
        <label class="text-left text-sm">Salida</label>
        <input id="salidaHora" type="time" class="swal2-input" value="${s}">
      </div>`,showCancelButton:!0,confirmButtonText:"Guardar",cancelButtonText:"Cancelar",preConfirm:()=>{const c=document.getElementById("entradaHora").value,f=document.getElementById("salidaHora").value;return!c&&!f?(Swal.showValidationMessage("Debes indicar al menos una hora"),!1):{entrada:c,salida:f}}});if(!i.isConfirmed)return;const b=l.id.toString().replace(/^turno-/,"");await k(E().asignacion.updateHoras.replace("__ID__",b),{method:"POST",body:i.value}),l.setExtendedProp("entrada",i.value.entrada),l.setExtendedProp("salida",i.value.salida),Swal.fire({icon:"success",title:"Horas actualizadas",timer:1500,showConfirmButton:!1})}function H(l,d,r){var f,t;const s=r.title||"Operario",i=((f=r.extendedProps)==null?void 0:f.categoria_nombre)??"",b=((t=r.extendedProps)==null?void 0:t.especialidad_nombre)??"Sin especialidad",c=D(l,d,`
    <div style="padding:10px 12px; font-size:13px; color:#6b7280; border-bottom:1px solid #f3f4f6;">
      ${s} <div style="font-size:12px">${i} ¬∑ ${b}</div>
    </div>
    <button id="ctx-editar-fichajes" style="display:block;width:100%;text-align:left;padding:10px 12px;font-size:14px;background:#fff;border:none;cursor:pointer;">
      ‚úèÔ∏è Editar fichajes
    </button>
    <button id="ctx-eliminar-registro" style="display:block;width:100%;text-align:left;padding:10px 12px;font-size:14px;background:#fff;border:none;cursor:pointer;color:#b91c1c;">
      üóëÔ∏è Eliminar registro
    </button>
  `);c.querySelector("#ctx-editar-fichajes").addEventListener("click",async()=>{y(),await R(r)}),c.querySelector("#ctx-eliminar-registro").addEventListener("click",async()=>{var u;if(y(),!await Swal.fire({icon:"warning",title:"Eliminar registro",html:`<div>¬øSeguro que quieres eliminar este evento/asignaci√≥n?</div>
                   <div class="text-xs text-gray-500 mt-1">Esta acci√≥n no se puede deshacer.</div>`,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",showCancelButton:!0,confirmButtonColor:"#b91c1c"}).then(a=>a.isConfirmed))return;const e="/asignaciones-turnos/destroy",n={_method:"DELETE",fecha_inicio:r.startStr,fecha_fin:r.endStr??r.startStr,tipo:"eliminarTurnoEstado",user_id:(u=r.extendedProps)==null?void 0:u.user_id};try{await k(e,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify(n)}),r.remove(),Swal.fire({icon:"success",title:"Registro eliminado",timer:1300,showConfirmButton:!1})}catch(a){console.error("Error al eliminar el turno:",a),Swal.fire({icon:"error",title:"Error al eliminar",text:a.message||"No se pudo eliminar el turno."})}})}function F(l,d,r){const s=localStorage.getItem(l);return d.includes(s)?s:r}function z(l){const{maquinas:d,eventos:r}=M(),s="vistaObras",i="fechaObras";let b=!1;const c=new FullCalendar.Calendar(l,{schedulerLicenseKey:"CC-Attribution-NonCommercial-NoDerivatives",locale:"es",initialView:F(s,["resourceTimelineDay","resourceTimelineWeek"],"resourceTimelineWeek"),initialDate:localStorage.getItem(i)||void 0,selectable:!0,unselectAuto:!0,datesSet(t){localStorage.setItem("vistaObras",t.view.type),localStorage.setItem("fechaObras",t.startStr);const o=document.getElementById("btnRepetirSemana");o&&(t.view.type==="resourceTimelineWeek"?(o.classList.remove("hidden"),o.dataset.fecha=t.startStr):o.classList.add("hidden"))},displayEventEnd:!0,eventMinHeight:30,firstDay:1,height:"auto",headerToolbar:{left:"prev,next today",center:"title",right:"resourceTimelineDay,resourceTimelineWeek"},buttonText:{today:"Hoy",week:"Semana",day:"D√≠a"},slotLabelDidMount(t){if(t.view.type==="resourceTimelineDay"){const e=parseInt(t.date.getHours());e>=6&&e<14?t.el.style.backgroundColor="#a7f3d0":e>=14&&e<22?t.el.style.backgroundColor="#bfdbfe":t.el.style.backgroundColor="#fde68a",t.el.style.borderRight="1px solid #e5e7eb"}},views:{resourceTimelineDay:{slotMinTime:"00:00:00",slotMaxTime:"21:59:00"},resourceTimelineWeek:{slotDuration:{days:1},slotLabelFormat:{weekday:"long",day:"numeric",month:"short"}}},editable:!0,resources:d,resourceOrder:"orden",resourceAreaWidth:"100px",resourceLabelDidMount(t){const o=t.resource.extendedProps.backgroundColor;o&&(t.el.style.backgroundColor=o,t.el.style.color="#fff")},filterResourcesWithEvents:!1,events:r,resourceAreaColumns:[{field:"title",headerContent:"M√°quinas"}],eventDragStart:t=>{b=!0;const o=t.el;o._tippy&&o._tippy.destroy(),document.querySelectorAll(".fc-event").forEach(e=>{e._tippy&&e._tippy.disable()})},eventDragStop:t=>{b=!1,setTimeout(()=>{document.querySelectorAll(".fc-event").forEach(o=>{o._tippy&&o._tippy.enable()})},100)},eventDrop:async t=>{var n,u;const o=t.event,e=o.extendedProps||{};try{if(e.es_festivo){const T=o.startStr.slice(0,10);await fetch(E().festivo.update.replace("__ID__",e.festivo_id),{method:"PUT",headers:{"X-CSRF-TOKEN":window.AppPlanif.csrf,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({fecha:T})}).then(C=>{if(!C.ok)throw new Error(`HTTP ${C.status}`)});return}const a=o.id.replace(/^turno-/,""),w=(n=o.getResources())==null?void 0:n[0],m=w?parseInt(w.id,10):null,p=(u=o.start)==null?void 0:u.toISOString(),v=new Date(p).getHours(),g=v>=6&&v<14?1:v>=14&&v<22?2:3;if(!m||!p)throw new Error("Datos incompletos");const S=E().asignacion.updatePuesto.replace("__ID__",a),h=await fetch(S,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":window.AppPlanif.csrf},body:JSON.stringify({maquina_id:m,start:p,turno_id:g})}),x=await h.json();if(!h.ok)throw new Error((x==null?void 0:x.message)||`HTTP ${h.status}`);x.color&&(o.setProp("backgroundColor",x.color),o.setProp("borderColor",x.color)),typeof x.nuevo_obra_id<"u"&&o.setExtendedProp("obra_id",x.nuevo_obra_id),c.refetchEvents()}catch(a){console.error(a),Swal.fire("Error",a.message||"Ocurri√≥ un error inesperado.","error"),t.revert()}},eventDidMount(t){const o=t.event,e=o.extendedProps||{};if(t.el._tippy&&t.el._tippy.destroy(),e.foto&&!e.es_festivo){const n=`<img src="${e.foto}" class="w-18 h-18 rounded-full object-cover ring-2 ring-blue-400 shadow-lg">`,u=tippy(t.el,{content:n,allowHTML:!0,placement:"top",theme:"transparent-avatar",interactive:!1,arrow:!1,delay:[100,0],offset:[0,10],onShow(){if(b)return!1}});b&&u&&u.disable()}t.el.addEventListener("contextmenu",n=>{n.preventDefault(),n.stopPropagation(),e.es_festivo?N(n.clientX,n.clientY,{event:o,titulo:o.title}):H(n.clientX,n.clientY,o)})},eventClick(t){const e=t.event.extendedProps||{};if(e.es_festivo)return;const n=e.user_id;if(n){const u=E().userShow.replace(":id",n);window.location.href=u}},eventContent(t){const o=t.event.extendedProps;if(o!=null&&o.es_festivo)return{html:`<div class="px-2 py-1 text-xs font-semibold" style="color:#fff">${t.event.title}</div>`};const e=o.entrada&&o.salida?`${o.entrada} / ${o.salida}`:o.entrada||o.salida||"-- / --";return{html:`
          <div class="px-2 py-1 text-xs font-semibold flex items-center">
            <div class="flex flex-col">
              <span>${t.event.title}</span>
              <span class="text-[10px] font-normal opacity-80">(${o.categoria_nombre??""} üõ† ${o.especialidad_nombre??"Sin especialidad"})</span>
            </div>
            <div class="ml-auto text-right">
              <span class="text-[10px] font-normal opacity-80">${e}</span>
            </div>
          </div>`}}});c.render(),console.log("[cal] Configurando event listener para contextmenu...");const f=c.el;return console.log("[cal] Elemento ra√≠z del calendario:",f),console.log("[cal] Agregando event listener de contextmenu al calendario"),f.addEventListener("contextmenu",t=>{if(console.log("[cal] ¬°Contextmenu disparado!",t.target),t.target.closest(".fc-event")){console.log("[cal] Es un evento, ignorando");return}t.preventDefault();let o=null,e=null;const n=t.target.closest("[data-date]");if(n&&(e=n.getAttribute("data-date")||"",e.length>=10&&(e=e.slice(0,10))),!e){console.log("[cal] No se pudo determinar la fecha");return}console.log("[cal] Fecha encontrada:",e),console.log("[cal] Elemento clickeado:",t.target),console.log("[cal] Elemento con data-date:",n);const u=f.querySelectorAll(".fc-timeline-lane[data-resource-id]");if(console.log("[cal] Filas de recursos encontradas:",u.length),u.length>0){const a=t.clientY;console.log("[cal] Posici√≥n Y del click:",a);for(const w of u){const m=w.getBoundingClientRect();if(console.log("[cal] Examinando lane con resource-id:",w.dataset.resourceId,"top:",m.top,"bottom:",m.bottom),a>=m.top&&a<=m.bottom){o=w.dataset.resourceId,console.log("[cal] ¬°ResourceId encontrado por posici√≥n Y!:",o);break}}}console.log("[cal] ResourceId final detectado:",o,"Fecha:",e),O(t.clientX,t.clientY,{fechaISO:e,resourceId:o},c,d)}),console.log("[cal] Event listener de contextmenu agregado correctamente"),c}function I(){const l=document.getElementById("calendario");if(!l||l.getAttribute("data-calendar-type")!=="trabajadores"||!window.AppPlanif)return;if(window.calendarTrabajadores){try{window.calendarTrabajadores.destroy()}catch{}window.calendarTrabajadores=null}const d=z(l);window.calendarTrabajadores=d}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",I,{once:!0}):I();document.addEventListener("livewire:navigating",()=>{if(window.calendarTrabajadores){try{window.calendarTrabajadores.destroy()}catch{}window.calendarTrabajadores=null}},{once:!0});

# Supervisor Configuration for Manager HPR Queue Workers
# Location: /etc/supervisor/conf.d/manager-worker.conf

[program:manager-worker]
# Process name with numbering
process_name=%(program_name)s_%(process_num)02d

# Command to run the queue worker
# Adjust the path to match your installation
command=php /var/www/manager/artisan queue:work database --sleep=3 --tries=3 --max-time=3600 --timeout=300

# Auto-start on system boot
autostart=true

# Auto-restart if the process dies
autorestart=true

# Stop the entire process group (important for Laravel workers)
stopasgroup=true
killasgroup=true

# User to run the process as
user=www-data

# Number of worker processes to run
# Adjust based on your server's resources and queue load
numprocs=2

# Redirect stderr to stdout
redirect_stderr=true

# Log file location
stdout_logfile=/var/www/manager/storage/logs/worker.log

# Maximum log file size before rotation (50MB)
stdout_logfile_maxbytes=50MB

# Keep 10 rotated log files
stdout_logfile_backups=10

# Time to wait for graceful shutdown before killing (1 hour)
# Important for long-running jobs
stopwaitsecs=3600

# Priority (lower = higher priority)
priority=999

# Environment variables
environment=
    LARAVEL_ENV="production"

# Restart after X number of seconds if the program exits
startsecs=3

# Number of seconds to wait before considering the process started
startretries=3
